(()=>{"use strict";const t=new class{audioContext;tracks=[];constructor(){this.audioContext=new AudioContext}async initAudio(t){if(console.log("Loading audio files..."),16!==t.length)throw new Error("Expected 16 audio files.");const e=t.map((t=>this.loadAudioFile(t)));(await Promise.all(e)).forEach((t=>{const e=this.audioContext.createBufferSource(),a=this.audioContext.createGain();e.buffer=t,a.gain.value=0,e.connect(a),a.connect(this.audioContext.destination),this.tracks.push({sourceNode:e,gainNode:a}),e.loop=!0,e.start(0)}))}async loadAudioFile(t){const e=await fetch(t),a=await e.arrayBuffer();return this.audioContext.decodeAudioData(a)}unMuteTrack(t){if(console.log("unMuteTrack",t),-1!=t){if(!this.tracks[t])throw new Error(`Track ${t} does not exist.`);this.tracks[t].gainNode.gain.value=1}}muteTrack(t){if(console.log("muteTrack",t),-1!=t){if(!this.tracks[t])throw new Error(`Track ${t} does not exist.`);this.tracks[t].gainNode.gain.value=0}}muteAll(){for(let t=0;t<this.tracks.length;t++)this.muteTrack(t)}};var e=!1;function a(t){const e=t.split("-");return e.length<2?-1:parseInt(e[1])}async function s(){e||(e=!0,await t.initAudio(["stems/drums.wav","stems/hats.wav","stems/kick-hat.wav","stems/toms.wav","stems/acid-and-chord.wav","stems/bass.wav","stems/drums.wav","stems/hats.wav","stems/kick-hat.wav","stems/toms.wav","stems/acid-and-chord.wav","stems/bass.wav","stems/drums.wav","stems/hats.wav","stems/kick-hat.wav","stems/toms.wav"]))}document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll(".ball"),n=document.querySelectorAll(".square");let o=null,i=null;const r=e=>{o&&e.classList.contains("square")&&(console.log("Dropped:",o.id,e.id),t.unMuteTrack(a(e.id)),e.appendChild(o),i=null,o.style.display="block",o=null)};e.forEach((e=>{e.addEventListener("dragstart",(n=>{s(),o=e,i=e.parentElement,n.dataTransfer?.setData("text/plain",e.id),console.log("Lifted:",e.id,"from",i.id),t.muteTrack(a(i.id))})),e.addEventListener("touchstart",(n=>{s(),o=e,i=e.parentElement,console.log("Lifted:",e.id,"from",i.id),n.preventDefault(),t.muteTrack(a(i.id))})),e.addEventListener("touchmove",(t=>{if(t.preventDefault(),1===t.touches.length){const a=t.touches[0];e.style.left=a.clientX-25+"px",e.style.top=a.clientY-25+"px"}})),e.addEventListener("touchend",(t=>{if(!o)return;o.style.display="none";const e=t.changedTouches[0],a=document.elementFromPoint(e.clientX,e.clientY);o.style.display="block",r(a)}))})),n.forEach((t=>{t.id||(t.id=`square-${Array.from(n).indexOf(t)}`),t.addEventListener("dragover",(t=>{t.preventDefault()})),t.addEventListener("drop",(e=>{e.preventDefault();const a=e.dataTransfer?.getData("text");a&&(document.getElementById(a),r(t))}))}))}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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L3NyYy9tYWluLnRzIiwid2VicGFjazovL3NxdWFyZXMvLi9zcmMvYXVkaW8udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXVkaW9Db250cm9sbGVyIH0gZnJvbSBcIi4vYXVkaW9cIjtcblxuY29uc3QgYWMgPSBuZXcgQXVkaW9Db250cm9sbGVyKCk7XG52YXIgaXNQbGF5aW5nID0gZmFsc2U7XG52YXIgaXNJbml0aWF0ZWQgPSBmYWxzZTtcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xuICBjb25zdCBiYWxsczogTm9kZUxpc3RPZjxIVE1MRWxlbWVudD4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmJhbGxcIik7XG4gIGNvbnN0IHNxdWFyZXM6IE5vZGVMaXN0T2Y8SFRNTEVsZW1lbnQ+ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zcXVhcmVcIik7XG4gIGxldCBhY3RpdmVCYWxsOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBsZXQgb3JpZ2luU3F1YXJlOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0IGRyb3BCYWxsID0gKHRhcmdldDogSFRNTEVsZW1lbnQpID0+IHtcbiAgICBpZiAoYWN0aXZlQmFsbCAmJiB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwic3F1YXJlXCIpKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkRyb3BwZWQ6XCIsIGFjdGl2ZUJhbGwuaWQsIHRhcmdldC5pZCk7XG4gICAgICBhYy51bk11dGVUcmFjayhpZFRvSW50KHRhcmdldC5pZCkpO1xuICAgICAgdGFyZ2V0LmFwcGVuZENoaWxkKGFjdGl2ZUJhbGwpO1xuICAgICAgb3JpZ2luU3F1YXJlID0gbnVsbDtcbiAgICAgIGFjdGl2ZUJhbGwuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjsgLy8gTWFrZSBzdXJlIHRvIGRpc3BsYXkgdGhlIGJhbGwgYWdhaW5cbiAgICAgIGFjdGl2ZUJhbGwgPSBudWxsO1xuICAgIH1cbiAgfTtcblxuICBiYWxscy5mb3JFYWNoKChiYWxsKSA9PiB7XG4gICAgYmFsbC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ3N0YXJ0XCIsIChlOiBEcmFnRXZlbnQpID0+IHtcbiAgICAgICAgaW5pdEF1ZGlvKCk7XG4gICAgICBhY3RpdmVCYWxsID0gYmFsbDtcbiAgICAgIG9yaWdpblNxdWFyZSA9IGJhbGwucGFyZW50RWxlbWVudCBhcyBIVE1MRWxlbWVudDtcbiAgICAgIGUuZGF0YVRyYW5zZmVyPy5zZXREYXRhKFwidGV4dC9wbGFpblwiLCBiYWxsLmlkKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiTGlmdGVkOlwiLCBiYWxsLmlkLCBcImZyb21cIiwgb3JpZ2luU3F1YXJlLmlkKTtcbiAgICAgIGFjLm11dGVUcmFjayhpZFRvSW50KG9yaWdpblNxdWFyZS5pZCkpO1xuICAgIH0pO1xuXG4gICAgYmFsbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCAoZTogVG91Y2hFdmVudCkgPT4ge1xuICAgICAgICBpbml0QXVkaW8oKTtcbiAgICAgIGFjdGl2ZUJhbGwgPSBiYWxsO1xuICAgICAgb3JpZ2luU3F1YXJlID0gYmFsbC5wYXJlbnRFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xuICAgICAgY29uc29sZS5sb2coXCJMaWZ0ZWQ6XCIsIGJhbGwuaWQsIFwiZnJvbVwiLCBvcmlnaW5TcXVhcmUuaWQpO1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgYWMubXV0ZVRyYWNrKGlkVG9JbnQob3JpZ2luU3F1YXJlLmlkKSk7XG4gICAgfSk7XG5cbiAgICBiYWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaG1vdmVcIiwgKGU6IFRvdWNoRXZlbnQpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGNvbnN0IHRvdWNoID0gZS50b3VjaGVzWzBdO1xuICAgICAgICBiYWxsLnN0eWxlLmxlZnQgPSBgJHt0b3VjaC5jbGllbnRYIC0gMjV9cHhgOyAvLyBBZGp1c3QgZm9yIGNlbnRlciBvZiB0aGUgYmFsbFxuICAgICAgICBiYWxsLnN0eWxlLnRvcCA9IGAke3RvdWNoLmNsaWVudFkgLSAyNX1weGA7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBiYWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCAoZTogVG91Y2hFdmVudCkgPT4ge1xuICAgICAgaWYgKCFhY3RpdmVCYWxsKSByZXR1cm47XG4gICAgICBhY3RpdmVCYWxsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjsgLy8gVGVtcG9yYXJpbHkgaGlkZSB0aGUgYmFsbCB0byBnZXQgZWxlbWVudCB1bmRlcm5lYXRoXG4gICAgICBjb25zdCB0b3VjaCA9IGUuY2hhbmdlZFRvdWNoZXNbMF07XG4gICAgICBjb25zdCB0YXJnZXRFbGVtZW50ID0gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludChcbiAgICAgICAgdG91Y2guY2xpZW50WCxcbiAgICAgICAgdG91Y2guY2xpZW50WVxuICAgICAgKSBhcyBIVE1MRWxlbWVudDtcbiAgICAgIGFjdGl2ZUJhbGwuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjsgLy8gUmUtZGlzcGxheSB0aGUgYmFsbFxuICAgICAgZHJvcEJhbGwodGFyZ2V0RWxlbWVudCk7XG4gICAgICAvLyAgIGNvbnNvbGUubG9nKFwiRHJvcHBlZDpcIiwgYmFsbC5pZCwgdGFyZ2V0RWxlbWVudC5pZCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIHNxdWFyZXMuZm9yRWFjaCgoc3F1YXJlKSA9PiB7XG4gICAgaWYgKCFzcXVhcmUuaWQpIHtcbiAgICAgIHNxdWFyZS5pZCA9IGBzcXVhcmUtJHtBcnJheS5mcm9tKHNxdWFyZXMpLmluZGV4T2Yoc3F1YXJlKX1gO1xuICAgIH1cbiAgICBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIChlOiBEcmFnRXZlbnQpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcblxuICAgIHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCAoZTogRHJhZ0V2ZW50KSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zdCBkYXRhID0gZS5kYXRhVHJhbnNmZXI/LmdldERhdGEoXCJ0ZXh0XCIpO1xuICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgY29uc3QgYmFsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRhdGEpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICBkcm9wQmFsbChzcXVhcmUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5mdW5jdGlvbiBpZFRvSW50KGlkOiBzdHJpbmcpOiBudW1iZXIge1xuICBjb25zdCBwYXJ0cyA9IGlkLnNwbGl0KFwiLVwiKTtcbiAgaWYgKHBhcnRzLmxlbmd0aCA8IDIpIHtcbiAgICByZXR1cm4gLTE7XG4gIH1cbiAgcmV0dXJuIHBhcnNlSW50KHBhcnRzWzFdKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gaW5pdEF1ZGlvKCkge1xuICBpZiAoaXNJbml0aWF0ZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaXNJbml0aWF0ZWQgPSB0cnVlO1xuICBhd2FpdCBhYy5pbml0QXVkaW8oW1xuICAgIFwic3RlbXMvZHJ1bXMud2F2XCIsXG4gICAgXCJzdGVtcy9oYXRzLndhdlwiLFxuICAgIFwic3RlbXMva2ljay1oYXQud2F2XCIsXG4gICAgXCJzdGVtcy90b21zLndhdlwiLFxuICAgIFwic3RlbXMvYWNpZC1hbmQtY2hvcmQud2F2XCIsXG4gICAgXCJzdGVtcy9iYXNzLndhdlwiLFxuICAgIFwic3RlbXMvZHJ1bXMud2F2XCIsXG4gICAgXCJzdGVtcy9oYXRzLndhdlwiLFxuICAgIFwic3RlbXMva2ljay1oYXQud2F2XCIsXG4gICAgXCJzdGVtcy90b21zLndhdlwiLFxuICAgIFwic3RlbXMvYWNpZC1hbmQtY2hvcmQud2F2XCIsXG4gICAgXCJzdGVtcy9iYXNzLndhdlwiLFxuICAgIFwic3RlbXMvZHJ1bXMud2F2XCIsXG4gICAgXCJzdGVtcy9oYXRzLndhdlwiLFxuICAgIFwic3RlbXMva2ljay1oYXQud2F2XCIsXG4gICAgXCJzdGVtcy90b21zLndhdlwiLFxuICBdKTtcbiAgLy8gICBhYy51bk11dGVUcmFjaygwKTtcbn1cbiIsImV4cG9ydCBjbGFzcyBBdWRpb0NvbnRyb2xsZXIge1xuICBwcml2YXRlIGF1ZGlvQ29udGV4dDogQXVkaW9Db250ZXh0O1xuICBwcml2YXRlIHRyYWNrczogeyBzb3VyY2VOb2RlOiBBdWRpb0J1ZmZlclNvdXJjZU5vZGU7IGdhaW5Ob2RlOiBHYWluTm9kZSB9W10gPVxuICAgIFtdO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuYXVkaW9Db250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xuICB9XG5cbiAgYXN5bmMgaW5pdEF1ZGlvKGZpbGVOYW1lczogc3RyaW5nW10pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZyhcIkxvYWRpbmcgYXVkaW8gZmlsZXMuLi5cIilcbiAgICBpZiAoZmlsZU5hbWVzLmxlbmd0aCAhPT0gMTYpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkV4cGVjdGVkIDE2IGF1ZGlvIGZpbGVzLlwiKTtcbiAgICB9XG5cbiAgICBjb25zdCBmaWxlUHJvbWlzZXMgPSBmaWxlTmFtZXMubWFwKChmaWxlTmFtZSkgPT5cbiAgICAgIHRoaXMubG9hZEF1ZGlvRmlsZShmaWxlTmFtZSlcbiAgICApO1xuXG4gICAgY29uc3QgYXVkaW9CdWZmZXJzID0gYXdhaXQgUHJvbWlzZS5hbGwoZmlsZVByb21pc2VzKTtcblxuICAgIGF1ZGlvQnVmZmVycy5mb3JFYWNoKChidWZmZXIpID0+IHtcbiAgICAgIGNvbnN0IHNvdXJjZU5vZGUgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgICAgIGNvbnN0IGdhaW5Ob2RlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlR2FpbigpO1xuXG4gICAgICBzb3VyY2VOb2RlLmJ1ZmZlciA9IGJ1ZmZlcjtcbiAgICAgIGdhaW5Ob2RlLmdhaW4udmFsdWUgPSAwOyAvLyBTdGFydCBtdXRlZFxuXG4gICAgICBzb3VyY2VOb2RlLmNvbm5lY3QoZ2Fpbk5vZGUpO1xuICAgICAgZ2Fpbk5vZGUuY29ubmVjdCh0aGlzLmF1ZGlvQ29udGV4dC5kZXN0aW5hdGlvbik7XG5cbiAgICAgIHRoaXMudHJhY2tzLnB1c2goeyBzb3VyY2VOb2RlLCBnYWluTm9kZSB9KTtcbiAgICBcbiAgICAgIHNvdXJjZU5vZGUubG9vcCA9IHRydWU7XG4gICAgICBzb3VyY2VOb2RlLnN0YXJ0KDApOyAvLyBQbGF5IGltbWVkaWF0ZWx5IGluIHN5bmNcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9hZEF1ZGlvRmlsZSh1cmw6IHN0cmluZyk6IFByb21pc2U8QXVkaW9CdWZmZXI+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpO1xuICAgIHJldHVybiB0aGlzLmF1ZGlvQ29udGV4dC5kZWNvZGVBdWRpb0RhdGEoYXJyYXlCdWZmZXIpO1xuICB9XG5cbiAgdW5NdXRlVHJhY2sodHJhY2tOdW1iZXI6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnNvbGUubG9nKFwidW5NdXRlVHJhY2tcIiwgdHJhY2tOdW1iZXIpXG4gICAgaWYgKHRyYWNrTnVtYmVyID09IC0xKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLnRyYWNrc1t0cmFja051bWJlcl0pIHtcbiAgICAgIHRoaXMudHJhY2tzW3RyYWNrTnVtYmVyXS5nYWluTm9kZS5nYWluLnZhbHVlID0gMTsgLy8gU2V0IGdhaW4gdG8gMSB0byB1bm11dGVcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUcmFjayAke3RyYWNrTnVtYmVyfSBkb2VzIG5vdCBleGlzdC5gKTtcbiAgICB9XG4gIH1cblxuICBtdXRlVHJhY2sodHJhY2tOdW1iZXI6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnNvbGUubG9nKFwibXV0ZVRyYWNrXCIsIHRyYWNrTnVtYmVyKTtcbiAgICBpZiAodHJhY2tOdW1iZXIgPT0gLTEpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy50cmFja3NbdHJhY2tOdW1iZXJdKSB7XG4gICAgICB0aGlzLnRyYWNrc1t0cmFja051bWJlcl0uZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IDA7IC8vIFNldCBnYWluIHRvIDAgdG8gbXV0ZVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRyYWNrICR7dHJhY2tOdW1iZXJ9IGRvZXMgbm90IGV4aXN0LmApO1xuICAgIH1cbiAgfVxuXG4gIG11dGVBbGwoKTogdm9pZCB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRyYWNrcy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5tdXRlVHJhY2soaSk7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOlsiYWMiLCJhdWRpb0NvbnRleHQiLCJ0cmFja3MiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJBdWRpb0NvbnRleHQiLCJpbml0QXVkaW8iLCJmaWxlTmFtZXMiLCJjb25zb2xlIiwibG9nIiwibGVuZ3RoIiwiRXJyb3IiLCJmaWxlUHJvbWlzZXMiLCJtYXAiLCJmaWxlTmFtZSIsImxvYWRBdWRpb0ZpbGUiLCJQcm9taXNlIiwiYWxsIiwiZm9yRWFjaCIsImJ1ZmZlciIsInNvdXJjZU5vZGUiLCJjcmVhdGVCdWZmZXJTb3VyY2UiLCJnYWluTm9kZSIsImNyZWF0ZUdhaW4iLCJnYWluIiwidmFsdWUiLCJjb25uZWN0IiwiZGVzdGluYXRpb24iLCJwdXNoIiwibG9vcCIsInN0YXJ0IiwidXJsIiwicmVzcG9uc2UiLCJmZXRjaCIsImFycmF5QnVmZmVyIiwiZGVjb2RlQXVkaW9EYXRhIiwidW5NdXRlVHJhY2siLCJ0cmFja051bWJlciIsIm11dGVUcmFjayIsIm11dGVBbGwiLCJpIiwiaXNJbml0aWF0ZWQiLCJpZFRvSW50IiwiaWQiLCJwYXJ0cyIsInNwbGl0IiwicGFyc2VJbnQiLCJhc3luYyIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImJhbGxzIiwicXVlcnlTZWxlY3RvckFsbCIsInNxdWFyZXMiLCJhY3RpdmVCYWxsIiwib3JpZ2luU3F1YXJlIiwiZHJvcEJhbGwiLCJ0YXJnZXQiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImFwcGVuZENoaWxkIiwic3R5bGUiLCJkaXNwbGF5IiwiYmFsbCIsImUiLCJwYXJlbnRFbGVtZW50IiwiZGF0YVRyYW5zZmVyIiwic2V0RGF0YSIsInByZXZlbnREZWZhdWx0IiwidG91Y2hlcyIsInRvdWNoIiwibGVmdCIsImNsaWVudFgiLCJ0b3AiLCJjbGllbnRZIiwiY2hhbmdlZFRvdWNoZXMiLCJ0YXJnZXRFbGVtZW50IiwiZWxlbWVudEZyb21Qb2ludCIsInNxdWFyZSIsIkFycmF5IiwiZnJvbSIsImluZGV4T2YiLCJkYXRhIiwiZ2V0RGF0YSIsImdldEVsZW1lbnRCeUlkIl0sInNvdXJjZVJvb3QiOiIifQ==