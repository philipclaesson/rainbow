(()=>{"use strict";const e=new class{audioContext;tracks=[];slowAverage=39;fx1a=null;fx1b=null;loadedFiles=0;constructor(){this.audioContext=new AudioContext}async initAudio(e){if(16!==e.length)throw new Error("Expected 16 audio files.");const t=e.map((e=>this.loadAudioFile(e)));(await Promise.all(t)).forEach((e=>{const t=this.audioContext.createBufferSource(),n=this.audioContext.createGain();t.buffer=e,n.gain.value=0,t.connect(n);const o=this.audioContext.createAnalyser();o.fftSize=2048,n.connect(o),this.fx1a=this.audioContext.createBiquadFilter(),this.fx1a.type="highpass",this.fx1a.frequency.value=1e3,this.fx1a.gain.value=0,n.connect(this.fx1a),this.fx1b=this.audioContext.createDelay(),this.fx1b.delayTime.value=0,this.fx1a.connect(this.fx1b),n.connect(this.audioContext.destination),this.tracks.push({sourceNode:t,gainNode:n,analyserNode:o}),t.loop=!0,t.start(0)}))}async loadAudioFile(e){const t=await fetch(e),n=await t.arrayBuffer();return this.loadedFiles++,console.log(`Loaded ${this.loadedFiles} files.`),this.audioContext.decodeAudioData(n)}getFrequencyColor(e){if(0===this.tracks[e].gainNode.gain.value)return`hsl(${this.slowAverage+e}, 100%, 50%)`;const t=this.tracks[e].analyserNode,n=new Uint8Array(t.frequencyBinCount);t.getByteFrequencyData(n);const o=Math.max(...n),s=n.indexOf(o);return this.updateSlowAverage(s),`hsl(${this.slowAverage+e+10*s%240}, 100%, 50%)`}updateSlowAverage(e){this.slowAverage=this.slowAverage+.001*e%240}enableTrack(e,t){if(-1!=e){if(e>=this.tracks.length)throw new Error(`Track ${e} does not exist.`);this.tracks[e].gainNode.gain.value=t?.5:0}}muteAll(){for(let e=0;e<this.tracks.length;e++)this.enableTrack(e,!1)}fx1(e,t){if(0!=e&&0!=t&&Math.random()>.1)return;if(!this.fx1a||!this.fx1b)return;console.log("fx1 called with x:",e,"y:",t),console.log("AudioContext state:",this.audioContext.state),console.log("Current time:",this.audioContext.currentTime),console.log("Applying gain:",25*e,"to fx1a");const n=Math.floor(10*e);this.fx1a.gain.setValueAtTime(n,this.audioContext.currentTime),this.fx1b.delayTime.setValueAtTime(t,this.audioContext.currentTime),console.log(this.fx1a,this.fx1b)}},t=16;var n=!1,o=null;function s(e){if("undefined"!=typeof TouchEvent&&e instanceof TouchEvent&&(e.touches||e.changedTouches)){const t=e.touches.length>0?e.touches:e.changedTouches;return{x:t[0].clientX,y:t[0].clientY}}if(e instanceof MouseEvent)return{x:e.clientX,y:e.clientY};throw new Error("Unsupported event type")}function i(e,t,n,o){const s=document.createElement(e);return s.classList.add(t),s.id=n,o.appendChild(s),s}function a(e){document.querySelectorAll(".ball").forEach((t=>{t.style.display=e?"block":"none"}))}function r(e){if(!e)return-1;const t=e.split("square-");return t.length<2?-1:parseInt(t[1])}function c(e){if(e)i("div","spinner","spinner",document.body),o=i("progress","progress","progress",document.body),setTimeout(u,100);else{const e=document.getElementById("spinner");e?.remove(),o?.remove()}}function u(){if(!o)return;const t=e.loadedFiles/16;console.log("Progress:",t),o.setAttribute("value",t.toString()),1!=t&&setTimeout(u,100)}function l(){const o=document.getElementById("start-button"),u=document.getElementById("info-1"),l=document.getElementById("info-2");o?.addEventListener("click",(async()=>{o.remove(),u?.remove(),l?.remove(),c(!0),await async function(){n||(await e.initAudio(["stems/4-on-floor.wav","stems/dnb-124.wav","stems/drums.wav","stems/hats.wav","stems/kick-hat.wav","stems/toms.wav","stems/smooth-chords.wav","stems/bass.wav","stems/bzzz.wav","stems/guitar.wav","stems/dnb-124.wav","stems/drums.wav","stems/hats.wav","stems/keep-on.wav","stems/what-u-doin-to-me.wav","stems/extacy.wav"]),n=!0)}(),c(!1),function(){const e=i("div","matrix","matrix",document.body);for(let n=0;n<t;n++)i("div","square",`square-${n}`,e);const n=i("div","ballhome","ballhome",document.body);for(let e=0;e<4;e++){const t=i("div","ball",`ball-${e}`,n);t.draggable=!0,t.innerText="ðŸŒˆ"}}(),function(){const t=document.querySelectorAll(".ball");var n=!1;t.forEach((t=>{function n(e){e.preventDefault();const n=t.parentElement;t.setAttribute("origin-square",n.id),t.setAttribute("clicked","true"),console.log(`[${e.type}] Lifted`,t.id,"from",n.id)}function o(e){if(e.preventDefault(),"true"!==t.getAttribute("clicked"))return;const n=s(e);t.style.left=n.x-50+"px",t.style.top=n.y-50+"px"}function i(n){if("true"!==t.getAttribute("clicked"))return;const o=s(n),i=t.getAttribute("origin-square");e.enableTrack(r(i),!1),t.setAttribute("clicked","false"),a(!1);const c=document.elementFromPoint(o.x,o.y);a(!0),((t,n)=>{console.log("Dropped:",t.id,n.id),e.enableTrack(r(n.id),!0),n.appendChild(t)})(t,c),console.log(`[${n.type}] Dropped`,t.id,"from",i)}t.addEventListener("mousedown",n),t.addEventListener("mousemove",o),t.addEventListener("mouseup",i),t.addEventListener("touchstart",n),t.addEventListener("touchmove",o),t.addEventListener("touchend",i)})),document.addEventListener("mouseup",(e=>{n=!1})),document.addEventListener("mousedown",(e=>{n=!0})),document.addEventListener("mousemove",(e=>{if(!n)return;const o=s(e);var i=t[0];for(let e=0;e<t.length;e++)"true"===t[e].getAttribute("clicked")&&(i=t[e]);i&&0!=function(e,t,n){const o=e.getBoundingClientRect(),s=o.left+o.width/2,i=o.top+o.height/2;return Math.sqrt((s-t)**2+(i-n)**2)}(i,e.clientX,e.clientY)&&(i.style.left=o.x-50+"px",i.style.top=o.y-50+"px")}))}(),d()}))}function d(){if(requestAnimationFrame(d),n)for(let n=0;n<t;n++){const t=document.getElementById(`square-${n}`);t&&(t.style.backgroundColor=e.getFrequencyColor(n))}}document.addEventListener("DOMContentLoaded",(()=>{l()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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USxFQUFLSyxPQUFTLEVBQ3ZDLE9BQU8zRixLQUFLNEYsTUFBTUosRUFBUTlFLElBQU0sR0FBS2dGLEVBQVEvRSxJQUFNLEVBQ3JELENBWFFrRixDQUFpQlIsRUFBYWhFLEVBQUVJLFFBQVNKLEVBQUVLLFdBQy9DMkQsRUFBWTNDLE1BQU1tQyxLQUFVRCxFQUFTbEUsRUFBSSxHQUFoQixLQUN6QjJFLEVBQVkzQyxNQUFNb0MsSUFBU0YsRUFBU2pFLEVBQUksR0FBaEIsS0FBc0IsR0FFbEQsQ0FtTEltRixHQUVBQyxHQUFNLEdBRVYsQ0FNQSxTQUFTQSxJQUVQLEdBREFDLHNCQUFzQkQsR0FDakI3RSxFQUdMLElBQUssSUFBSVYsRUFBSSxFQUFHQSxFQUFJUyxFQUFVVCxJQUFLLENBQ2pDLE1BQU15RixFQUFTL0QsU0FBU2tCLGVBQWUsVUFBVTVDLEtBQzdDeUYsSUFDRkEsRUFBT3ZELE1BQU13RCxnQkFBa0J6SixFQUFHZ0Qsa0JBQWtCZSxHLENBRzFELENBZkEwQixTQUFTMkIsaUJBQWlCLG9CQUFvQixLQUM1Q0osR0FBbUIsRyIsInNvdXJjZXMiOlsid2VicGFjazovL3NxdWFyZXMvLi9zcmMvbWFpbi50cyIsIndlYnBhY2s6Ly9zcXVhcmVzLy4vc3JjL2F1ZGlvLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEF1ZGlvQ29udHJvbGxlciB9IGZyb20gXCIuL2F1ZGlvXCI7XG5cbmNvbnN0IGFjID0gbmV3IEF1ZGlvQ29udHJvbGxlcigpO1xuY29uc3QgblNxdWFyZXMgPSAxNjtcbmNvbnN0IG5CYWxscyA9IDQ7XG52YXIgaXNJbml0aWF0ZWQgPSBmYWxzZTtcbnZhciBmeEVuYWJsZSA9IGZhbHNlO1xudmFyIHByb2dyZXNzQmFyOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuXG5mdW5jdGlvbiBjcmVhdGVVSUVsZW1lbnRzKCkge1xuICAvLyBDcmVhdGUgRlggdWlcbiAgaWYgKGZ4RW5hYmxlKSB7XG4gICAgY29uc3QgZnhkaXYgPSBjcmVhdGVFbGVtZW50KFwiZGl2XCIsIFwiZnhcIiwgXCJmeFwiLCBkb2N1bWVudC5ib2R5KTtcbiAgICBmeGRpdi5zdHlsZS5kaXNwbGF5ID0gZnhFbmFibGUgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcbiAgICBjb25zdCBmeDEgPSBjcmVhdGVFbGVtZW50KFwiZGl2XCIsIFwiZngxXCIsIFwiZngxXCIsIGZ4ZGl2KTtcbiAgICBmeDEuaW5uZXJUZXh0ID0gXCLwn4yKXCI7XG4gICAgY29uc3QgZnhzcGFjZXIgPSBjcmVhdGVFbGVtZW50KFwiZGl2XCIsIFwiZnhzcGFjZXJcIiwgXCJmeHNwYWNlclwiLCBmeGRpdik7XG4gICAgY29uc3QgZngyID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBcImZ4MlwiLCBcImZ4MlwiLCBmeGRpdik7XG4gICAgZngyLmlubmVyVGV4dCA9IFwi8J+VpVwiO1xuICB9XG5cbiAgY29uc3QgbWF0cml4ID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBcIm1hdHJpeFwiLCBcIm1hdHJpeFwiLCBkb2N1bWVudC5ib2R5KTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuU3F1YXJlczsgaSsrKSB7XG4gICAgY3JlYXRlRWxlbWVudChcImRpdlwiLCBcInNxdWFyZVwiLCBgc3F1YXJlLSR7aX1gLCBtYXRyaXgpO1xuICB9XG5cbiAgY29uc3QgYmFsbEhvbWUgPSBjcmVhdGVFbGVtZW50KFwiZGl2XCIsIFwiYmFsbGhvbWVcIiwgXCJiYWxsaG9tZVwiLCBkb2N1bWVudC5ib2R5KTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuQmFsbHM7IGkrKykge1xuICAgIGNvbnN0IGJhbGwgPSBjcmVhdGVFbGVtZW50KFwiZGl2XCIsIFwiYmFsbFwiLCBgYmFsbC0ke2l9YCwgYmFsbEhvbWUpO1xuICAgIGJhbGwuZHJhZ2dhYmxlID0gdHJ1ZTtcbiAgICBiYWxsLmlubmVyVGV4dCA9IGDwn4yIYDtcbiAgfVxufVxuXG5mdW5jdGlvbiBpbml0VUlMb2dpYygpIHtcbiAgY29uc3QgYmFsbHM6IE5vZGVMaXN0T2Y8SFRNTEVsZW1lbnQ+ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5iYWxsXCIpO1xuICB2YXIgbW91c2VEb3duID0gZmFsc2U7XG4gIC8vIERyb3BzIGEgYmFsbCBpbnRvIGEgdGFyZ2V0IGVsZW1lbnQgYW5kIG11dGVzIHRoZSB0cmFjayB0aGUgYmFsbCBjYW1lIGZyb21cbiAgY29uc3QgZHJvcEJhbGwgPSAoYmFsbDogSFRNTEVsZW1lbnQsIHRhcmdldDogSFRNTEVsZW1lbnQpID0+IHtcbiAgICBjb25zb2xlLmxvZyhcIkRyb3BwZWQ6XCIsIGJhbGwuaWQsIHRhcmdldC5pZCk7XG4gICAgYWMuZW5hYmxlVHJhY2soZ2V0U3F1YXJlSWQodGFyZ2V0LmlkKSwgdHJ1ZSk7XG4gICAgdGFyZ2V0LmFwcGVuZENoaWxkKGJhbGwpO1xuICB9O1xuXG4gIGJhbGxzLmZvckVhY2goKGJhbGwpID0+IHtcbiAgICAvLyBDb21tb24gZnVuY3Rpb24gZm9yIHN0YXJ0aW5nIHRoZSBkcmFnXG4gICAgZnVuY3Rpb24gc3RhcnREcmFnKGU6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50KSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zdCBvcmlnaW5TcXVhcmUgPSBiYWxsLnBhcmVudEVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICBiYWxsLnNldEF0dHJpYnV0ZShcIm9yaWdpbi1zcXVhcmVcIiwgb3JpZ2luU3F1YXJlLmlkKTtcbiAgICAgIGJhbGwuc2V0QXR0cmlidXRlKFwiY2xpY2tlZFwiLCBcInRydWVcIik7XG4gICAgICBjb25zb2xlLmxvZyhgWyR7ZS50eXBlfV0gTGlmdGVkYCwgYmFsbC5pZCwgXCJmcm9tXCIsIG9yaWdpblNxdWFyZS5pZCk7XG4gICAgfVxuXG4gICAgLy8gQ29tbW9uIGZ1bmN0aW9uIGZvciBkcmFnZ2luZ1xuICAgIGZ1bmN0aW9uIGRvRHJhZyhlOiBNb3VzZUV2ZW50IHwgVG91Y2hFdmVudCkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgaWYgKGJhbGwuZ2V0QXR0cmlidXRlKFwiY2xpY2tlZFwiKSAhPT0gXCJ0cnVlXCIpIHJldHVybjtcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gZ2V0UG9zaXRpb25Gcm9tRXZlbnQoZSk7XG4gICAgICBiYWxsLnN0eWxlLmxlZnQgPSBgJHtwb3NpdGlvbi54IC0gNTB9cHhgO1xuICAgICAgYmFsbC5zdHlsZS50b3AgPSBgJHtwb3NpdGlvbi55IC0gNTB9cHhgO1xuICAgICAgLy8gY29uc29sZS5sb2coYFske2UudHlwZX1dIE1vdmluZy9EcmFnZ2luZ2AsIGJhbGwuaWQpO1xuICAgIH1cblxuICAgIC8vIENvbW1vbiBmdW5jdGlvbiBmb3IgZW5kaW5nIHRoZSBkcmFnXG4gICAgZnVuY3Rpb24gZW5kRHJhZyhlOiBNb3VzZUV2ZW50IHwgVG91Y2hFdmVudCkge1xuICAgICAgaWYgKGJhbGwuZ2V0QXR0cmlidXRlKFwiY2xpY2tlZFwiKSAhPT0gXCJ0cnVlXCIpIHJldHVybjtcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gZ2V0UG9zaXRpb25Gcm9tRXZlbnQoZSk7XG4gICAgICBjb25zdCBvcmlnaW5TcXVhcmVJZCA9IGJhbGwuZ2V0QXR0cmlidXRlKFwib3JpZ2luLXNxdWFyZVwiKTtcbiAgICAgIGFjLmVuYWJsZVRyYWNrKGdldFNxdWFyZUlkKG9yaWdpblNxdWFyZUlkKSwgZmFsc2UpO1xuICAgICAgYmFsbC5zZXRBdHRyaWJ1dGUoXCJjbGlja2VkXCIsIFwiZmFsc2VcIik7XG4gICAgICBzaG93QmFsbHMoZmFsc2UpO1xuICAgICAgY29uc3QgdGFyZ2V0RWxlbWVudCA9IGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQoXG4gICAgICAgIHBvc2l0aW9uLngsXG4gICAgICAgIHBvc2l0aW9uLnlcbiAgICAgICkgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICBzaG93QmFsbHModHJ1ZSk7XG4gICAgICBkcm9wQmFsbChiYWxsLCB0YXJnZXRFbGVtZW50KTtcbiAgICAgIGNvbnNvbGUubG9nKGBbJHtlLnR5cGV9XSBEcm9wcGVkYCwgYmFsbC5pZCwgXCJmcm9tXCIsIG9yaWdpblNxdWFyZUlkKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgYmFsbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHN0YXJ0RHJhZyk7XG4gICAgYmFsbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIGRvRHJhZyk7XG4gICAgYmFsbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBlbmREcmFnKTtcbiAgICBiYWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIHN0YXJ0RHJhZyk7XG4gICAgYmFsbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIGRvRHJhZyk7XG4gICAgYmFsbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgZW5kRHJhZyk7XG4gIH0pO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCAoZSkgPT4ge1xuICAgIG1vdXNlRG93biA9IGZhbHNlO1xuICB9KTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZSkgPT4ge1xuICAgIG1vdXNlRG93biA9IHRydWU7XG4gIH0pO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIChlKSA9PiB7XG4gICAgaWYgKCFtb3VzZURvd24pIHJldHVybjtcbiAgICBjb25zdCBwb3NpdGlvbiA9IGdldFBvc2l0aW9uRnJvbUV2ZW50KGUpO1xuICAgIHZhciBjbGlja2VkQmFsbDogSFRNTEVsZW1lbnQgfCBudWxsID0gYmFsbHNbMF07XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJhbGxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoYmFsbHNbaV0uZ2V0QXR0cmlidXRlKFwiY2xpY2tlZFwiKSA9PT0gXCJ0cnVlXCIpe1xuICAgICAgICBjbGlja2VkQmFsbCA9IGJhbGxzW2ldO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWNsaWNrZWRCYWxsKSByZXR1cm47XG4gICAgaWYgKGRpc3RhbmNlRnJvbUJhbGwoY2xpY2tlZEJhbGwsIGUuY2xpZW50WCwgZS5jbGllbnRZKSA9PSAwKSByZXR1cm47XG4gICAgY2xpY2tlZEJhbGwuc3R5bGUubGVmdCA9IGAke3Bvc2l0aW9uLnggLSA1MH1weGA7XG4gICAgY2xpY2tlZEJhbGwuc3R5bGUudG9wID0gYCR7cG9zaXRpb24ueSAtIDUwfXB4YDtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGRpc3RhbmNlRnJvbUJhbGwoYmFsbDogSFRNTEVsZW1lbnQsIHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gIGNvbnN0IHJlY3QgPSBiYWxsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICBjb25zdCBiYWxsWCA9IHJlY3QubGVmdCArIHJlY3Qud2lkdGggLyAyO1xuICBjb25zdCBiYWxsWSA9IHJlY3QudG9wICsgcmVjdC5oZWlnaHQgLyAyO1xuICByZXR1cm4gTWF0aC5zcXJ0KChiYWxsWCAtIHgpICoqIDIgKyAoYmFsbFkgLSB5KSAqKiAyKTtcbn1cblxuLy8gSGVscGVyIHRvIGV4dHJhY3QgcG9zaXRpb24gZnJvbSBldmVudFxuZnVuY3Rpb24gZ2V0UG9zaXRpb25Gcm9tRXZlbnQoZTogYW55KSB7XG4gIGlmIChcbiAgICB0eXBlb2YgVG91Y2hFdmVudCAhPT0gXCJ1bmRlZmluZWRcIiAmJlxuICAgIGUgaW5zdGFuY2VvZiBUb3VjaEV2ZW50ICYmXG4gICAgKGUudG91Y2hlcyB8fCBlLmNoYW5nZWRUb3VjaGVzKVxuICApIHtcbiAgICBjb25zdCB0b3VjaGVzID0gZS50b3VjaGVzLmxlbmd0aCA+IDAgPyBlLnRvdWNoZXMgOiBlLmNoYW5nZWRUb3VjaGVzO1xuICAgIHJldHVybiB7IHg6IHRvdWNoZXNbMF0uY2xpZW50WCwgeTogdG91Y2hlc1swXS5jbGllbnRZIH07XG4gIH0gZWxzZSBpZiAoZSBpbnN0YW5jZW9mIE1vdXNlRXZlbnQpIHtcbiAgICByZXR1cm4geyB4OiBlLmNsaWVudFgsIHk6IGUuY2xpZW50WSB9O1xuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBFcnJvcihcIlVuc3VwcG9ydGVkIGV2ZW50IHR5cGVcIik7XG4gIH1cbn1cblxuZnVuY3Rpb24gaW5pdEZYVUkoKSB7XG4gIGlmICghZnhFbmFibGUpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgZngxID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmeDFcIik7XG4gIGlmICghZngxKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiZngxIG5vdCBmb3VuZFwiKTtcbiAgfVxuICBmeDEuZHJhZ2dhYmxlID0gdHJ1ZTtcbiAgY29uc3QgZngyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmeDJcIik7XG4gIGZ4MT8uYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCAoZTogRHJhZ0V2ZW50KSA9PiB7XG4gICAgY29uc3QgeyB4LCB5IH0gPSBub3JtYWxpemVkWFkoZS54LCBlLnkpO1xuICAgIGFjLmZ4MSh4LCB5KTtcbiAgICBjb25zb2xlLmxvZyhcImRyYWdzdGFydFwiKTtcbiAgfSk7XG4gIGZ4MT8uYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdcIiwgKGU6IERyYWdFdmVudCkgPT4ge1xuICAgIGNvbnN0IHsgeCwgeSB9ID0gbm9ybWFsaXplZFhZKGUueCwgZS55KTtcbiAgICBhYy5meDEoeCwgeSk7XG4gICAgY29uc29sZS5sb2coXCJkcmFnbW92ZVwiKTtcbiAgfSk7XG4gIGZ4MT8uYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdlbmRcIiwgKGU6IERyYWdFdmVudCkgPT4ge1xuICAgIGFjLmZ4MSgwLCAwKTtcbiAgICBjb25zb2xlLmxvZyhcImRyYWdlbmRcIik7XG4gIH0pO1xuICBmeDE/LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIChlOiBUb3VjaEV2ZW50KSA9PiB7XG4gICAgaWYgKGUudG91Y2hlcy5sZW5ndGggIT0gMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB0b3VjaCA9IGUudG91Y2hlc1swXTtcbiAgICBjb25zdCB7IHgsIHkgfSA9IG5vcm1hbGl6ZWRYWSh0b3VjaC5jbGllbnRYLCB0b3VjaC5jbGllbnRZKTtcbiAgICBhYy5meDEoeCwgeSk7XG4gICAgY29uc29sZS5sb2coXCJ0b3VjaHN0YXJ0XCIpO1xuICB9KTtcbiAgZngxPy5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIChlOiBUb3VjaEV2ZW50KSA9PiB7XG4gICAgaWYgKGUudG91Y2hlcy5sZW5ndGggIT0gMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB0b3VjaCA9IGUudG91Y2hlc1swXTtcbiAgICBjb25zdCB7IHgsIHkgfSA9IG5vcm1hbGl6ZWRYWSh0b3VjaC5jbGllbnRYLCB0b3VjaC5jbGllbnRZKTtcbiAgICBhYy5meDEoeCwgeSk7XG4gICAgY29uc29sZS5sb2coXCJ0b3VjaG1vdmVcIik7XG4gIH0pO1xuICBmeDE/LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCAoZTogVG91Y2hFdmVudCkgPT4ge1xuICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoICE9IDEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYWMuZngxKDAsIDApO1xuICAgIGNvbnNvbGUubG9nKFwidG91Y2hlbmRcIik7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVFbGVtZW50KFxuICB0YWc6IHN0cmluZyxcbiAgY2xzOiBzdHJpbmcsXG4gIGlkOiBzdHJpbmcsXG4gIHBhcmVudDogSFRNTEVsZW1lbnRcbikge1xuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoY2xzKTtcbiAgZWxlbWVudC5pZCA9IGlkO1xuICBwYXJlbnQuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gIHJldHVybiBlbGVtZW50O1xufVxuXG5mdW5jdGlvbiBzaG93QmFsbHMoc2hvdzogYm9vbGVhbikge1xuICBjb25zdCBiYWxsczogTm9kZUxpc3RPZjxIVE1MRWxlbWVudD4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmJhbGxcIik7XG4gIGJhbGxzLmZvckVhY2goKGJhbGwpID0+IHtcbiAgICBiYWxsLnN0eWxlLmRpc3BsYXkgPSBzaG93ID8gXCJibG9ja1wiIDogXCJub25lXCI7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRTcXVhcmVJZChpZDogc3RyaW5nIHwgbnVsbCk6IG51bWJlciB7XG4gIGlmICghaWQpIHtcbiAgICByZXR1cm4gLTE7XG4gIH1cbiAgY29uc3QgcGFydHMgPSBpZC5zcGxpdChcInNxdWFyZS1cIik7XG4gIGlmIChwYXJ0cy5sZW5ndGggPCAyKSB7XG4gICAgcmV0dXJuIC0xO1xuICB9XG4gIHJldHVybiBwYXJzZUludChwYXJ0c1sxXSk7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZWRYWSh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICBjb25zdCB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICBjb25zdCBoZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gIHJldHVybiB7IHg6IHggLyB3aWR0aCwgeTogeSAvIGhlaWdodCB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBpbml0QXVkaW8oKSB7XG4gIGlmIChpc0luaXRpYXRlZCkge1xuICAgIHJldHVybjtcbiAgfVxuICBhd2FpdCBhYy5pbml0QXVkaW8oW1xuICAgIFwic3RlbXMvNC1vbi1mbG9vci53YXZcIixcbiAgICBcInN0ZW1zL2RuYi0xMjQud2F2XCIsXG4gICAgXCJzdGVtcy9kcnVtcy53YXZcIixcbiAgICBcInN0ZW1zL2hhdHMud2F2XCIsXG4gICAgXCJzdGVtcy9raWNrLWhhdC53YXZcIixcbiAgICBcInN0ZW1zL3RvbXMud2F2XCIsXG4gICAgXCJzdGVtcy9zbW9vdGgtY2hvcmRzLndhdlwiLFxuICAgIFwic3RlbXMvYmFzcy53YXZcIixcbiAgICBcInN0ZW1zL2J6enoud2F2XCIsXG4gICAgXCJzdGVtcy9ndWl0YXIud2F2XCIsXG4gICAgXCJzdGVtcy9kbmItMTI0LndhdlwiLFxuICAgIFwic3RlbXMvZHJ1bXMud2F2XCIsXG4gICAgXCJzdGVtcy9oYXRzLndhdlwiLFxuICAgIFwic3RlbXMva2VlcC1vbi53YXZcIixcbiAgICBcInN0ZW1zL3doYXQtdS1kb2luLXRvLW1lLndhdlwiLFxuICAgIFwic3RlbXMvZXh0YWN5LndhdlwiLFxuICBdKTtcbiAgaXNJbml0aWF0ZWQgPSB0cnVlO1xufVxuXG5mdW5jdGlvbiBzcGlubmVyKHNob3c6IGJvb2xlYW4pIHtcbiAgaWYgKHNob3cpIHtcbiAgICBjcmVhdGVFbGVtZW50KFwiZGl2XCIsIFwic3Bpbm5lclwiLCBcInNwaW5uZXJcIiwgZG9jdW1lbnQuYm9keSk7XG4gICAgcHJvZ3Jlc3NCYXIgPSBjcmVhdGVFbGVtZW50KFxuICAgICAgXCJwcm9ncmVzc1wiLFxuICAgICAgXCJwcm9ncmVzc1wiLFxuICAgICAgXCJwcm9ncmVzc1wiLFxuICAgICAgZG9jdW1lbnQuYm9keVxuICAgICk7XG4gICAgc2V0VGltZW91dChzZXRQcm9ncmVzcywgMTAwKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzcGlubmVyXCIpO1xuICAgIHNwaW5uZXI/LnJlbW92ZSgpO1xuICAgIHByb2dyZXNzQmFyPy5yZW1vdmUoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzZXRQcm9ncmVzcygpIHtcbiAgaWYgKCFwcm9ncmVzc0Jhcikge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBwID0gYWMubG9hZGVkRmlsZXMgLyAxNjtcbiAgY29uc29sZS5sb2coXCJQcm9ncmVzczpcIiwgcCk7XG4gIHByb2dyZXNzQmFyLnNldEF0dHJpYnV0ZShcInZhbHVlXCIsIHAudG9TdHJpbmcoKSk7XG4gIGlmIChwICE9IDEpIHtcbiAgICBzZXRUaW1lb3V0KHNldFByb2dyZXNzLCAxMDApO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVN0YXJ0QnV0dG9uKCkge1xuICBjb25zdCBzdGFydEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RhcnQtYnV0dG9uXCIpO1xuICBjb25zdCBpbmZvMSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaW5mby0xXCIpO1xuICBjb25zdCBpbmZvMiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaW5mby0yXCIpO1xuICBzdGFydEJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICBzdGFydEJ1dHRvbi5yZW1vdmUoKTtcbiAgICBpbmZvMT8ucmVtb3ZlKCk7XG4gICAgaW5mbzI/LnJlbW92ZSgpO1xuICAgIHNwaW5uZXIodHJ1ZSk7XG4gICAgYXdhaXQgaW5pdEF1ZGlvKCk7XG4gICAgc3Bpbm5lcihmYWxzZSk7XG4gICAgY3JlYXRlVUlFbGVtZW50cygpO1xuICAgIGluaXRVSUxvZ2ljKCk7XG4gICAgaW5pdEZYVUkoKTtcbiAgICBkcmF3KCk7XG4gIH0pO1xufVxuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XG4gIGNyZWF0ZVN0YXJ0QnV0dG9uKCk7XG59KTtcblxuZnVuY3Rpb24gZHJhdygpIHtcbiAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGRyYXcpO1xuICBpZiAoIWlzSW5pdGlhdGVkKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgblNxdWFyZXM7IGkrKykge1xuICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBzcXVhcmUtJHtpfWApIGFzIEhUTUxFbGVtZW50O1xuICAgIGlmIChzcXVhcmUpIHtcbiAgICAgIHNxdWFyZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBhYy5nZXRGcmVxdWVuY3lDb2xvcihpKTtcbiAgICB9XG4gIH1cbn1cbiIsImV4cG9ydCBjbGFzcyBBdWRpb0NvbnRyb2xsZXIge1xuICBwcml2YXRlIGF1ZGlvQ29udGV4dDogQXVkaW9Db250ZXh0O1xuICBwcml2YXRlIHRyYWNrczoge1xuICAgIHNvdXJjZU5vZGU6IEF1ZGlvQnVmZmVyU291cmNlTm9kZTtcbiAgICBnYWluTm9kZTogR2Fpbk5vZGU7XG4gICAgYW5hbHlzZXJOb2RlOiBBbmFseXNlck5vZGU7XG4gIH1bXSA9IFtdO1xuICBwcml2YXRlIHNsb3dBdmVyYWdlOiBudW1iZXIgPSAzOTsgLy8gb3JhbmdlXG4gIHByaXZhdGUgZngxYTogQmlxdWFkRmlsdGVyTm9kZSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGZ4MWI6IERlbGF5Tm9kZSB8IG51bGwgPSBudWxsO1xuICBwdWJsaWMgbG9hZGVkRmlsZXM6IG51bWJlciA9IDA7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5hdWRpb0NvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KCk7XG4gIH1cblxuICBhc3luYyBpbml0QXVkaW8oZmlsZU5hbWVzOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmIChmaWxlTmFtZXMubGVuZ3RoICE9PSAxNikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRXhwZWN0ZWQgMTYgYXVkaW8gZmlsZXMuXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IGZpbGVQcm9taXNlcyA9IGZpbGVOYW1lcy5tYXAoKGZpbGVOYW1lKSA9PlxuICAgICAgdGhpcy5sb2FkQXVkaW9GaWxlKGZpbGVOYW1lKVxuICAgICk7XG5cbiAgICBjb25zdCBhdWRpb0J1ZmZlcnMgPSBhd2FpdCBQcm9taXNlLmFsbChmaWxlUHJvbWlzZXMpO1xuXG4gICAgYXVkaW9CdWZmZXJzLmZvckVhY2goKGJ1ZmZlcikgPT4ge1xuICAgICAgY29uc3Qgc291cmNlTm9kZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xuICAgICAgY29uc3QgZ2Fpbk5vZGUgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVHYWluKCk7XG5cbiAgICAgIHNvdXJjZU5vZGUuYnVmZmVyID0gYnVmZmVyO1xuICAgICAgZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IDA7IC8vIFN0YXJ0IG11dGVkXG4gICAgICBzb3VyY2VOb2RlLmNvbm5lY3QoZ2Fpbk5vZGUpO1xuXG4gICAgICAvLyBzZXQgdXAgYW4gYW5hbHlzZXIgc28gd2UgY2FuIGRvIGNvb2wgdmlzdWFsc1xuICAgICAgY29uc3QgYW5hbHlzZXJOb2RlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlQW5hbHlzZXIoKTtcbiAgICAgIGFuYWx5c2VyTm9kZS5mZnRTaXplID0gMjA0ODtcbiAgICAgIGdhaW5Ob2RlLmNvbm5lY3QoYW5hbHlzZXJOb2RlKTtcblxuICAgICAgLy8gc2V0IHVwIGZ4IG5vZGVzXG4gICAgICB0aGlzLmZ4MWEgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVCaXF1YWRGaWx0ZXIoKTtcbiAgICAgIHRoaXMuZngxYS50eXBlID0gXCJoaWdocGFzc1wiO1xuICAgICAgdGhpcy5meDFhLmZyZXF1ZW5jeS52YWx1ZSA9IDEwMDA7XG4gICAgICB0aGlzLmZ4MWEuZ2Fpbi52YWx1ZSA9IDA7XG4gICAgICBnYWluTm9kZS5jb25uZWN0KHRoaXMuZngxYSk7XG5cbiAgICAgIHRoaXMuZngxYiA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZURlbGF5KCk7XG4gICAgICB0aGlzLmZ4MWIuZGVsYXlUaW1lLnZhbHVlID0gMDsgLy8gcGFzcyB0aHJvdWdoXG4gICAgICB0aGlzLmZ4MWEuY29ubmVjdCh0aGlzLmZ4MWIpO1xuXG4gICAgICAvLyBmb3Igbm93IGp1c3QgYnlwYXNzIHRoZSBGWCBub2RlcyAtIG5vdCBpbXBsZW1lbnRlZCBwcm9wZXJseSB5ZXRcbiAgICAgIC8vICAgdGhpcy5meDFiLmNvbm5lY3QodGhpcy5hdWRpb0NvbnRleHQuZGVzdGluYXRpb24pO1xuICAgICAgZ2Fpbk5vZGUuY29ubmVjdCh0aGlzLmF1ZGlvQ29udGV4dC5kZXN0aW5hdGlvbik7XG5cbiAgICAgIHRoaXMudHJhY2tzLnB1c2goeyBzb3VyY2VOb2RlLCBnYWluTm9kZSwgYW5hbHlzZXJOb2RlIH0pO1xuXG4gICAgICBzb3VyY2VOb2RlLmxvb3AgPSB0cnVlO1xuICAgICAgc291cmNlTm9kZS5zdGFydCgwKTsgLy8gUGxheSBpbW1lZGlhdGVseSBpbiBzeW5jXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxvYWRBdWRpb0ZpbGUodXJsOiBzdHJpbmcpOiBQcm9taXNlPEF1ZGlvQnVmZmVyPiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwpO1xuICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTtcbiAgICB0aGlzLmxvYWRlZEZpbGVzKys7XG4gICAgY29uc29sZS5sb2coYExvYWRlZCAke3RoaXMubG9hZGVkRmlsZXN9IGZpbGVzLmApXG4gICAgcmV0dXJuIHRoaXMuYXVkaW9Db250ZXh0LmRlY29kZUF1ZGlvRGF0YShhcnJheUJ1ZmZlcik7XG4gIH1cblxuICBnZXRGcmVxdWVuY3lDb2xvcih0cmFjazogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBjb25zdCBnYWluTm9kZSA9IHRoaXMudHJhY2tzW3RyYWNrXS5nYWluTm9kZTtcbiAgICBpZiAoZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9PT0gMCkge1xuICAgICAgcmV0dXJuIGBoc2woJHt0aGlzLnNsb3dBdmVyYWdlICsgdHJhY2t9LCAxMDAlLCA1MCUpYDtcbiAgICB9XG4gICAgY29uc3QgYW5hbHlzZXJOb2RlID0gdGhpcy50cmFja3NbdHJhY2tdLmFuYWx5c2VyTm9kZTtcbiAgICBjb25zdCBkYXRhQXJyYXkgPSBuZXcgVWludDhBcnJheShhbmFseXNlck5vZGUuZnJlcXVlbmN5QmluQ291bnQpO1xuICAgIGFuYWx5c2VyTm9kZS5nZXRCeXRlRnJlcXVlbmN5RGF0YShkYXRhQXJyYXkpO1xuXG4gICAgLy8gZ2V0IHRoZSBoaWdoZXN0IGZyZXF1ZW5jeVxuICAgIGNvbnN0IG1heCA9IE1hdGgubWF4KC4uLmRhdGFBcnJheSk7XG4gICAgY29uc3QgbWF4SW5kZXggPSBkYXRhQXJyYXkuaW5kZXhPZihtYXgpO1xuICAgIHRoaXMudXBkYXRlU2xvd0F2ZXJhZ2UobWF4SW5kZXgpO1xuXG4gICAgY29uc3QgaHVlID0gdGhpcy5zbG93QXZlcmFnZSArIHRyYWNrICsgKChtYXhJbmRleCAqIDEwKSAlIDI0MCk7XG4gICAgcmV0dXJuIGBoc2woJHtodWV9LCAxMDAlLCA1MCUpYDtcbiAgfVxuXG4gIHVwZGF0ZVNsb3dBdmVyYWdlKHZhbHVlOiBudW1iZXIpIHtcbiAgICB0aGlzLnNsb3dBdmVyYWdlID0gdGhpcy5zbG93QXZlcmFnZSArICgodmFsdWUgKiAwLjAwMSkgJSAyNDApO1xuICB9XG5cbiAgZW5hYmxlVHJhY2sodHJhY2tOdW1iZXI6IG51bWJlciwgZW5hYmxlOiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKHRyYWNrTnVtYmVyID09IC0xKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0cmFja051bWJlciA+PSB0aGlzLnRyYWNrcy5sZW5ndGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVHJhY2sgJHt0cmFja051bWJlcn0gZG9lcyBub3QgZXhpc3QuYCk7XG4gICAgfVxuICAgIHRoaXMudHJhY2tzW3RyYWNrTnVtYmVyXS5nYWluTm9kZS5nYWluLnZhbHVlID0gZW5hYmxlID8gMC41IDogMDtcbiAgfVxuXG4gIG11dGVBbGwoKTogdm9pZCB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRyYWNrcy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5lbmFibGVUcmFjayhpLCBmYWxzZSk7XG4gICAgfVxuICB9XG5cbiAgZngxKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgaWYgKHggIT0gMCAmJiB5ICE9IDApIHtcbiAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC4xKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCF0aGlzLmZ4MWEgfHwgIXRoaXMuZngxYikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhcImZ4MSBjYWxsZWQgd2l0aCB4OlwiLCB4LCBcInk6XCIsIHkpO1xuICAgIGNvbnNvbGUubG9nKFwiQXVkaW9Db250ZXh0IHN0YXRlOlwiLCB0aGlzLmF1ZGlvQ29udGV4dC5zdGF0ZSk7XG4gICAgY29uc29sZS5sb2coXCJDdXJyZW50IHRpbWU6XCIsIHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lKTtcblxuICAgIGNvbnNvbGUubG9nKFwiQXBwbHlpbmcgZ2FpbjpcIiwgeCAqIDI1LCBcInRvIGZ4MWFcIik7XG4gICAgY29uc3QgZ2FpbiA9IE1hdGguZmxvb3IoeCAqIDEwKTtcbiAgICB0aGlzLmZ4MWEuZ2Fpbi5zZXRWYWx1ZUF0VGltZShnYWluLCB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSk7XG4gICAgdGhpcy5meDFiLmRlbGF5VGltZS5zZXRWYWx1ZUF0VGltZSh5LCB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSk7XG5cbiAgICBjb25zb2xlLmxvZyh0aGlzLmZ4MWEsIHRoaXMuZngxYik7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJhYyIsImF1ZGlvQ29udGV4dCIsInRyYWNrcyIsInNsb3dBdmVyYWdlIiwiZngxYSIsImZ4MWIiLCJsb2FkZWRGaWxlcyIsImNvbnN0cnVjdG9yIiwidGhpcyIsIkF1ZGlvQ29udGV4dCIsImluaXRBdWRpbyIsImZpbGVOYW1lcyIsImxlbmd0aCIsIkVycm9yIiwiZmlsZVByb21pc2VzIiwibWFwIiwiZmlsZU5hbWUiLCJsb2FkQXVkaW9GaWxlIiwiUHJvbWlzZSIsImFsbCIsImZvckVhY2giLCJidWZmZXIiLCJzb3VyY2VOb2RlIiwiY3JlYXRlQnVmZmVyU291cmNlIiwiZ2Fpbk5vZGUiLCJjcmVhdGVHYWluIiwiZ2FpbiIsInZhbHVlIiwiY29ubmVjdCIsImFuYWx5c2VyTm9kZSIsImNyZWF0ZUFuYWx5c2VyIiwiZmZ0U2l6ZSIsImNyZWF0ZUJpcXVhZEZpbHRlciIsInR5cGUiLCJmcmVxdWVuY3kiLCJjcmVhdGVEZWxheSIsImRlbGF5VGltZSIsImRlc3RpbmF0aW9uIiwicHVzaCIsImxvb3AiLCJzdGFydCIsInVybCIsInJlc3BvbnNlIiwiZmV0Y2giLCJhcnJheUJ1ZmZlciIsImNvbnNvbGUiLCJsb2ciLCJkZWNvZGVBdWRpb0RhdGEiLCJnZXRGcmVxdWVuY3lDb2xvciIsInRyYWNrIiwiZGF0YUFycmF5IiwiVWludDhBcnJheSIsImZyZXF1ZW5jeUJpbkNvdW50IiwiZ2V0Qnl0ZUZyZXF1ZW5jeURhdGEiLCJtYXgiLCJNYXRoIiwibWF4SW5kZXgiLCJpbmRleE9mIiwidXBkYXRlU2xvd0F2ZXJhZ2UiLCJlbmFibGVUcmFjayIsInRyYWNrTnVtYmVyIiwiZW5hYmxlIiwibXV0ZUFsbCIsImkiLCJmeDEiLCJ4IiwieSIsInJhbmRvbSIsInN0YXRlIiwiY3VycmVudFRpbWUiLCJmbG9vciIsInNldFZhbHVlQXRUaW1lIiwiblNxdWFyZXMiLCJpc0luaXRpYXRlZCIsInByb2dyZXNzQmFyIiwiZ2V0UG9zaXRpb25Gcm9tRXZlbnQiLCJlIiwiVG91Y2hFdmVudCIsInRvdWNoZXMiLCJjaGFuZ2VkVG91Y2hlcyIsImNsaWVudFgiLCJjbGllbnRZIiwiTW91c2VFdmVudCIsImNyZWF0ZUVsZW1lbnQiLCJ0YWciLCJjbHMiLCJpZCIsInBhcmVudCIsImVsZW1lbnQiLCJkb2N1bWVudCIsImNsYXNzTGlzdCIsImFkZCIsImFwcGVuZENoaWxkIiwic2hvd0JhbGxzIiwic2hvdyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJiYWxsIiwic3R5bGUiLCJkaXNwbGF5IiwiZ2V0U3F1YXJlSWQiLCJwYXJ0cyIsInNwbGl0IiwicGFyc2VJbnQiLCJzcGlubmVyIiwiYm9keSIsInNldFRpbWVvdXQiLCJzZXRQcm9ncmVzcyIsImdldEVsZW1lbnRCeUlkIiwicmVtb3ZlIiwicCIsInNldEF0dHJpYnV0ZSIsInRvU3RyaW5nIiwiY3JlYXRlU3RhcnRCdXR0b24iLCJzdGFydEJ1dHRvbiIsImluZm8xIiwiaW5mbzIiLCJhZGRFdmVudExpc3RlbmVyIiwiYXN5bmMiLCJtYXRyaXgiLCJiYWxsSG9tZSIsImRyYWdnYWJsZSIsImlubmVyVGV4dCIsImNyZWF0ZVVJRWxlbWVudHMiLCJiYWxscyIsIm1vdXNlRG93biIsInN0YXJ0RHJhZyIsInByZXZlbnREZWZhdWx0Iiwib3JpZ2luU3F1YXJlIiwicGFyZW50RWxlbWVudCIsImRvRHJhZyIsImdldEF0dHJpYnV0ZSIsInBvc2l0aW9uIiwibGVmdCIsInRvcCIsImVuZERyYWciLCJvcmlnaW5TcXVhcmVJZCIsInRhcmdldEVsZW1lbnQiLCJlbGVtZW50RnJvbVBvaW50IiwidGFyZ2V0IiwiZHJvcEJhbGwiLCJjbGlja2VkQmFsbCIsInJlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJiYWxsWCIsIndpZHRoIiwiYmFsbFkiLCJoZWlnaHQiLCJzcXJ0IiwiZGlzdGFuY2VGcm9tQmFsbCIsImluaXRVSUxvZ2ljIiwiZHJhdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInNxdWFyZSIsImJhY2tncm91bmRDb2xvciJdLCJzb3VyY2VSb290IjoiIn0=