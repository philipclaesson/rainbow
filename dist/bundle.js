(()=>{"use strict";const e=new class{audioContext;tracks=[];constructor(){this.audioContext=new AudioContext}async initAudio(e){if(console.log("Loading audio files..."),16!==e.length)throw new Error("Expected 16 audio files.");const t=e.map((e=>this.loadAudioFile(e)));(await Promise.all(t)).forEach((e=>{const t=this.audioContext.createBufferSource(),n=this.audioContext.createGain();t.buffer=e,n.gain.value=0,t.connect(n),n.connect(this.audioContext.destination),this.tracks.push({sourceNode:t,gainNode:n}),t.loop=!0,t.start(0)}))}async loadAudioFile(e){const t=await fetch(e),n=await t.arrayBuffer();return this.audioContext.decodeAudioData(n)}unMuteTrack(e){if(console.log("unMuteTrack",e),-1!=e){if(!this.tracks[e])throw new Error(`Track ${e} does not exist.`);this.tracks[e].gainNode.gain.value=1}}muteTrack(e){if(console.log("muteTrack",e),-1!=e){if(!this.tracks[e])throw new Error(`Track ${e} does not exist.`);this.tracks[e].gainNode.gain.value=0}}muteAll(){for(let e=0;e<this.tracks.length;e++)this.muteTrack(e)}};var t=!1,n=!1,o=null;function a(e){document.querySelectorAll(".ball").forEach((t=>{t.style.display=e?"block":"none"}))}function s(e){if(!e)return-1;const t=e.split("square-");return t.length<2?-1:parseInt(t[1])}document.addEventListener("DOMContentLoaded",(()=>{!function(){const d=document.getElementById("start-button");d?.addEventListener("click",(()=>{d.remove(),function(){const e=document.createElement("div");e.classList.add("matrix"),e.id="matrix",document.body.appendChild(e);for(let t=0;t<16;t++){const n=document.createElement("div");n.classList.add("square"),n.id=`square-${t}`,e.appendChild(n)}(o=document.createElement("div")).classList.add("ballhome"),o.id="ballhome",document.body.appendChild(o);for(let e=0;e<3;e++){const t=document.createElement("div");t.classList.add("ball"),t.id=`ball-${e}`,t.draggable=!0,o.appendChild(t)}}(),function(){const t=document.querySelectorAll(".ball"),d=document.querySelectorAll(".square");let r=null,i=null;const c=t=>{r&&(console.log("Dropped:",r.id,t.id),e.unMuteTrack(s(t.id)),t.appendChild(r),i=null,r.style.display="block",r=null)};if(t.forEach((t=>{t.addEventListener("dragstart",(n=>{r=t,i=t.parentElement,n.dataTransfer?.setData("text/plain",t.id),console.log("[Dragstart]: Lifted",t.id,"from",i.id),e.muteTrack(s(i.id))})),t.addEventListener("touchstart",(o=>{n=!0,r=t,i=t.parentElement,console.log("[Touchstart] Lifted",t.id,"from",i.id),e.muteTrack(s(i.id))})),t.addEventListener("touchmove",(e=>{if(console.log("[Touchmove] Dragging",t.id,e.touches.length),e.preventDefault(),n=!0,1===e.touches.length){const n=e.touches[0];t.style.left=n.clientX-25+"px",t.style.top=n.clientY-25+"px"}})),t.addEventListener("touchend",(e=>{if(console.log("[Touchend] Dropped",t.id),!r)return;a(!1);const n=e.changedTouches[0],o=document.elementFromPoint(n.clientX,n.clientY);a(!0),c(o)}))})),d.forEach((e=>{e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(t=>{t.preventDefault(),c(e)}))})),!o)throw new Error("Ball home not found");o.addEventListener("dragover",(e=>{e.preventDefault()})),o.addEventListener("drop",(e=>{if(e.preventDefault(),!o)throw new Error("Ball home not found");c(o)})),document.addEventListener("dragover",(e=>{n||e.preventDefault()})),document.addEventListener("drop",(e=>{if(!n){const e=document.getElementById("ballhome");c(e)}}))}(),async function(){t||(t=!0,await e.initAudio(["stems/drums.wav","stems/hats.wav","stems/kick-hat.wav","stems/toms.wav","stems/acid-and-chord.wav","stems/bass.wav","stems/drums.wav","stems/hats.wav","stems/kick-hat.wav","stems/toms.wav","stems/acid-and-chord.wav","stems/bass.wav","stems/drums.wav","stems/hats.wav","stems/kick-hat.wav","stems/toms.wav"]))}()}))}()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LDJCQUNBLGlCQUNBLGtCQUNBLGlCQUNBLHFCQUNBLGlCQUNBLDJCQUNBLGlCQUNBLGtCQUNBLGlCQUNBLHFCQUNBLG1CQUdKLENBUUlBLEVBQVcsR0FFZixDQUdFcUYsRUFBbUIsRyIsInNvdXJjZXMiOlsid2VicGFjazovL3NxdWFyZXMvLi9zcmMvbWFpbi50cyIsIndlYnBhY2s6Ly9zcXVhcmVzLy4vc3JjL2F1ZGlvLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEF1ZGlvQ29udHJvbGxlciB9IGZyb20gXCIuL2F1ZGlvXCI7XG5cbmNvbnN0IGFjID0gbmV3IEF1ZGlvQ29udHJvbGxlcigpO1xuY29uc3QgblNxdWFyZXMgPSAxNjtcbmNvbnN0IG5CYWxscyA9IDM7XG52YXIgaXNQbGF5aW5nID0gZmFsc2U7XG52YXIgaXNJbml0aWF0ZWQgPSBmYWxzZTtcbnZhciBtb2JpbGVVc2FnZSA9IGZhbHNlO1xudmFyIGJhbGxIb21lOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuXG5mdW5jdGlvbiBjcmVhdGVVSSgpIHtcbiAgY29uc3QgbWF0cml4ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgbWF0cml4LmNsYXNzTGlzdC5hZGQoXCJtYXRyaXhcIik7XG4gIG1hdHJpeC5pZCA9IFwibWF0cml4XCI7XG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobWF0cml4KTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuU3F1YXJlczsgaSsrKSB7XG4gICAgY29uc3Qgc3F1YXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcInNxdWFyZVwiKTtcbiAgICBzcXVhcmUuaWQgPSBgc3F1YXJlLSR7aX1gO1xuICAgIG1hdHJpeC5hcHBlbmRDaGlsZChzcXVhcmUpO1xuICB9XG4gIGJhbGxIb21lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgYmFsbEhvbWUuY2xhc3NMaXN0LmFkZChcImJhbGxob21lXCIpO1xuICBiYWxsSG9tZS5pZCA9IFwiYmFsbGhvbWVcIjtcbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChiYWxsSG9tZSk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuQmFsbHM7IGkrKykge1xuICAgIGNvbnN0IGJhbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGJhbGwuY2xhc3NMaXN0LmFkZChcImJhbGxcIik7XG4gICAgYmFsbC5pZCA9IGBiYWxsLSR7aX1gO1xuICAgIGJhbGwuZHJhZ2dhYmxlID0gdHJ1ZTtcbiAgICBiYWxsSG9tZS5hcHBlbmRDaGlsZChiYWxsKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpbml0VUkoKSB7XG4gIGNvbnN0IGJhbGxzOiBOb2RlTGlzdE9mPEhUTUxFbGVtZW50PiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYmFsbFwiKTtcbiAgY29uc3Qgc3F1YXJlczogTm9kZUxpc3RPZjxIVE1MRWxlbWVudD4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNxdWFyZVwiKTtcbiAgbGV0IGFjdGl2ZUJhbGw6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIGxldCBvcmlnaW5TcXVhcmU6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3QgZHJvcEJhbGwgPSAodGFyZ2V0OiBIVE1MRWxlbWVudCkgPT4ge1xuICAgIGlmIChhY3RpdmVCYWxsKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkRyb3BwZWQ6XCIsIGFjdGl2ZUJhbGwuaWQsIHRhcmdldC5pZCk7XG4gICAgICBhYy51bk11dGVUcmFjayhnZXRTcXVhcmVJZCh0YXJnZXQuaWQpKTtcbiAgICAgIHRhcmdldC5hcHBlbmRDaGlsZChhY3RpdmVCYWxsKTtcbiAgICAgIG9yaWdpblNxdWFyZSA9IG51bGw7XG4gICAgICBhY3RpdmVCYWxsLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7IC8vIE1ha2Ugc3VyZSB0byBkaXNwbGF5IHRoZSBiYWxsIGFnYWluXG4gICAgICBhY3RpdmVCYWxsID0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgYmFsbHMuZm9yRWFjaCgoYmFsbCkgPT4ge1xuICAgIGJhbGwuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCAoZTogRHJhZ0V2ZW50KSA9PiB7XG4gICAgICBhY3RpdmVCYWxsID0gYmFsbDtcbiAgICAgIG9yaWdpblNxdWFyZSA9IGJhbGwucGFyZW50RWxlbWVudCBhcyBIVE1MRWxlbWVudDtcbiAgICAgIGUuZGF0YVRyYW5zZmVyPy5zZXREYXRhKFwidGV4dC9wbGFpblwiLCBiYWxsLmlkKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiW0RyYWdzdGFydF06IExpZnRlZFwiLCBiYWxsLmlkLCBcImZyb21cIiwgb3JpZ2luU3F1YXJlLmlkKTtcbiAgICAgIGFjLm11dGVUcmFjayhnZXRTcXVhcmVJZChvcmlnaW5TcXVhcmUuaWQpKTtcbiAgICB9KTtcblxuICAgIGJhbGwuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgKGU6IFRvdWNoRXZlbnQpID0+IHtcbiAgICAgIG1vYmlsZVVzYWdlID0gdHJ1ZTtcbiAgICAgIGFjdGl2ZUJhbGwgPSBiYWxsO1xuICAgICAgb3JpZ2luU3F1YXJlID0gYmFsbC5wYXJlbnRFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xuICAgICAgY29uc29sZS5sb2coXCJbVG91Y2hzdGFydF0gTGlmdGVkXCIsIGJhbGwuaWQsIFwiZnJvbVwiLCBvcmlnaW5TcXVhcmUuaWQpO1xuICAgICAgYWMubXV0ZVRyYWNrKGdldFNxdWFyZUlkKG9yaWdpblNxdWFyZS5pZCkpO1xuICAgIH0pO1xuXG4gICAgYmFsbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIChlOiBUb3VjaEV2ZW50KSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIltUb3VjaG1vdmVdIERyYWdnaW5nXCIsIGJhbGwuaWQsIGUudG91Y2hlcy5sZW5ndGgpO1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgbW9iaWxlVXNhZ2UgPSB0cnVlO1xuICAgICAgaWYgKGUudG91Y2hlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgY29uc3QgdG91Y2ggPSBlLnRvdWNoZXNbMF07XG4gICAgICAgIGJhbGwuc3R5bGUubGVmdCA9IGAke3RvdWNoLmNsaWVudFggLSAyNX1weGA7IC8vIEFkanVzdCBmb3IgY2VudGVyIG9mIHRoZSBiYWxsXG4gICAgICAgIGJhbGwuc3R5bGUudG9wID0gYCR7dG91Y2guY2xpZW50WSAtIDI1fXB4YDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGJhbGwuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIChlOiBUb3VjaEV2ZW50KSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIltUb3VjaGVuZF0gRHJvcHBlZFwiLCBiYWxsLmlkKTtcbiAgICAgIGlmICghYWN0aXZlQmFsbCkgcmV0dXJuO1xuICAgICAgc2hvd0JhbGxzKGZhbHNlKTtcbiAgICAgIGNvbnN0IHRvdWNoID0gZS5jaGFuZ2VkVG91Y2hlc1swXTtcbiAgICAgIGNvbnN0IHRhcmdldEVsZW1lbnQgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KFxuICAgICAgICB0b3VjaC5jbGllbnRYLFxuICAgICAgICB0b3VjaC5jbGllbnRZXG4gICAgICApIGFzIEhUTUxFbGVtZW50O1xuICAgICAgc2hvd0JhbGxzKHRydWUpO1xuICAgICAgZHJvcEJhbGwodGFyZ2V0RWxlbWVudCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIHNxdWFyZXMuZm9yRWFjaCgoc3F1YXJlKSA9PiB7XG4gICAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCAoZTogRHJhZ0V2ZW50KSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG5cbiAgICBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgKGU6IERyYWdFdmVudCkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZHJvcEJhbGwoc3F1YXJlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgaWYgKCFiYWxsSG9tZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkJhbGwgaG9tZSBub3QgZm91bmRcIik7XG4gIH1cbiAgYmFsbEhvbWUuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIChlOiBEcmFnRXZlbnQpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIH0pO1xuXG4gIGJhbGxIb21lLmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIChlOiBEcmFnRXZlbnQpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKCFiYWxsSG9tZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQmFsbCBob21lIG5vdCBmb3VuZFwiKTtcbiAgICB9XG4gICAgZHJvcEJhbGwoYmFsbEhvbWUpO1xuICB9KTtcblxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ292ZXJcIiwgKGUpID0+IHtcbiAgICBpZiAoIW1vYmlsZVVzYWdlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7IC8vIFRoaXMgYWxsb3dzIHRoZSBkcm9wIHRvIGJlIGFjY2VwdGVkLlxuICAgIH1cbiAgfSk7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIChlKSA9PiB7XG4gICAgaWYgKCFtb2JpbGVVc2FnZSkge1xuICAgICAgY29uc3QgYmFsbEhvbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhbGxob21lXCIpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgZHJvcEJhbGwoYmFsbEhvbWUpO1xuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHNob3dCYWxscyhzaG93OiBib29sZWFuKSB7XG4gIGNvbnN0IGJhbGxzOiBOb2RlTGlzdE9mPEhUTUxFbGVtZW50PiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYmFsbFwiKTtcbiAgYmFsbHMuZm9yRWFjaCgoYmFsbCkgPT4ge1xuICAgIGJhbGwuc3R5bGUuZGlzcGxheSA9IHNob3cgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldFNxdWFyZUlkKGlkOiBzdHJpbmcgfCBudWxsKTogbnVtYmVyIHtcbiAgaWYgKCFpZCkge1xuICAgIHJldHVybiAtMTtcbiAgfVxuICBjb25zdCBwYXJ0cyA9IGlkLnNwbGl0KFwic3F1YXJlLVwiKTtcbiAgaWYgKHBhcnRzLmxlbmd0aCA8IDIpIHtcbiAgICByZXR1cm4gLTE7XG4gIH1cbiAgcmV0dXJuIHBhcnNlSW50KHBhcnRzWzFdKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gaW5pdEF1ZGlvKCkge1xuICBpZiAoaXNJbml0aWF0ZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaXNJbml0aWF0ZWQgPSB0cnVlO1xuICBhd2FpdCBhYy5pbml0QXVkaW8oW1xuICAgIFwic3RlbXMvZHJ1bXMud2F2XCIsXG4gICAgXCJzdGVtcy9oYXRzLndhdlwiLFxuICAgIFwic3RlbXMva2ljay1oYXQud2F2XCIsXG4gICAgXCJzdGVtcy90b21zLndhdlwiLFxuICAgIFwic3RlbXMvYWNpZC1hbmQtY2hvcmQud2F2XCIsXG4gICAgXCJzdGVtcy9iYXNzLndhdlwiLFxuICAgIFwic3RlbXMvZHJ1bXMud2F2XCIsXG4gICAgXCJzdGVtcy9oYXRzLndhdlwiLFxuICAgIFwic3RlbXMva2ljay1oYXQud2F2XCIsXG4gICAgXCJzdGVtcy90b21zLndhdlwiLFxuICAgIFwic3RlbXMvYWNpZC1hbmQtY2hvcmQud2F2XCIsXG4gICAgXCJzdGVtcy9iYXNzLndhdlwiLFxuICAgIFwic3RlbXMvZHJ1bXMud2F2XCIsXG4gICAgXCJzdGVtcy9oYXRzLndhdlwiLFxuICAgIFwic3RlbXMva2ljay1oYXQud2F2XCIsXG4gICAgXCJzdGVtcy90b21zLndhdlwiLFxuICBdKTtcbiAgLy8gICBhYy51bk11dGVUcmFjaygwKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlU3RhcnRCdXR0b24oKSB7XG4gIGNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGFydC1idXR0b25cIik7XG4gIHN0YXJ0QnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHN0YXJ0QnV0dG9uLnJlbW92ZSgpO1xuICAgIGNyZWF0ZVVJKCk7XG4gICAgaW5pdFVJKCk7XG4gICAgaW5pdEF1ZGlvKCk7XG4gIH0pO1xufVxuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XG4gIGNyZWF0ZVN0YXJ0QnV0dG9uKCk7XG59KTtcbiIsImV4cG9ydCBjbGFzcyBBdWRpb0NvbnRyb2xsZXIge1xuICBwcml2YXRlIGF1ZGlvQ29udGV4dDogQXVkaW9Db250ZXh0O1xuICBwcml2YXRlIHRyYWNrczogeyBzb3VyY2VOb2RlOiBBdWRpb0J1ZmZlclNvdXJjZU5vZGU7IGdhaW5Ob2RlOiBHYWluTm9kZSB9W10gPVxuICAgIFtdO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuYXVkaW9Db250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xuICB9XG5cbiAgYXN5bmMgaW5pdEF1ZGlvKGZpbGVOYW1lczogc3RyaW5nW10pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZyhcIkxvYWRpbmcgYXVkaW8gZmlsZXMuLi5cIilcbiAgICBpZiAoZmlsZU5hbWVzLmxlbmd0aCAhPT0gMTYpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkV4cGVjdGVkIDE2IGF1ZGlvIGZpbGVzLlwiKTtcbiAgICB9XG5cbiAgICBjb25zdCBmaWxlUHJvbWlzZXMgPSBmaWxlTmFtZXMubWFwKChmaWxlTmFtZSkgPT5cbiAgICAgIHRoaXMubG9hZEF1ZGlvRmlsZShmaWxlTmFtZSlcbiAgICApO1xuXG4gICAgY29uc3QgYXVkaW9CdWZmZXJzID0gYXdhaXQgUHJvbWlzZS5hbGwoZmlsZVByb21pc2VzKTtcblxuICAgIGF1ZGlvQnVmZmVycy5mb3JFYWNoKChidWZmZXIpID0+IHtcbiAgICAgIGNvbnN0IHNvdXJjZU5vZGUgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgICAgIGNvbnN0IGdhaW5Ob2RlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlR2FpbigpO1xuXG4gICAgICBzb3VyY2VOb2RlLmJ1ZmZlciA9IGJ1ZmZlcjtcbiAgICAgIGdhaW5Ob2RlLmdhaW4udmFsdWUgPSAwOyAvLyBTdGFydCBtdXRlZFxuXG4gICAgICBzb3VyY2VOb2RlLmNvbm5lY3QoZ2Fpbk5vZGUpO1xuICAgICAgZ2Fpbk5vZGUuY29ubmVjdCh0aGlzLmF1ZGlvQ29udGV4dC5kZXN0aW5hdGlvbik7XG5cbiAgICAgIHRoaXMudHJhY2tzLnB1c2goeyBzb3VyY2VOb2RlLCBnYWluTm9kZSB9KTtcbiAgICBcbiAgICAgIHNvdXJjZU5vZGUubG9vcCA9IHRydWU7XG4gICAgICBzb3VyY2VOb2RlLnN0YXJ0KDApOyAvLyBQbGF5IGltbWVkaWF0ZWx5IGluIHN5bmNcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9hZEF1ZGlvRmlsZSh1cmw6IHN0cmluZyk6IFByb21pc2U8QXVkaW9CdWZmZXI+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpO1xuICAgIHJldHVybiB0aGlzLmF1ZGlvQ29udGV4dC5kZWNvZGVBdWRpb0RhdGEoYXJyYXlCdWZmZXIpO1xuICB9XG5cbiAgdW5NdXRlVHJhY2sodHJhY2tOdW1iZXI6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnNvbGUubG9nKFwidW5NdXRlVHJhY2tcIiwgdHJhY2tOdW1iZXIpXG4gICAgaWYgKHRyYWNrTnVtYmVyID09IC0xKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLnRyYWNrc1t0cmFja051bWJlcl0pIHtcbiAgICAgIHRoaXMudHJhY2tzW3RyYWNrTnVtYmVyXS5nYWluTm9kZS5nYWluLnZhbHVlID0gMTsgLy8gU2V0IGdhaW4gdG8gMSB0byB1bm11dGVcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUcmFjayAke3RyYWNrTnVtYmVyfSBkb2VzIG5vdCBleGlzdC5gKTtcbiAgICB9XG4gIH1cblxuICBtdXRlVHJhY2sodHJhY2tOdW1iZXI6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnNvbGUubG9nKFwibXV0ZVRyYWNrXCIsIHRyYWNrTnVtYmVyKTtcbiAgICBpZiAodHJhY2tOdW1iZXIgPT0gLTEpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy50cmFja3NbdHJhY2tOdW1iZXJdKSB7XG4gICAgICB0aGlzLnRyYWNrc1t0cmFja051bWJlcl0uZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IDA7IC8vIFNldCBnYWluIHRvIDAgdG8gbXV0ZVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRyYWNrICR7dHJhY2tOdW1iZXJ9IGRvZXMgbm90IGV4aXN0LmApO1xuICAgIH1cbiAgfVxuXG4gIG11dGVBbGwoKTogdm9pZCB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRyYWNrcy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5tdXRlVHJhY2soaSk7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOlsiYWMiLCJhdWRpb0NvbnRleHQiLCJ0cmFja3MiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJBdWRpb0NvbnRleHQiLCJpbml0QXVkaW8iLCJmaWxlTmFtZXMiLCJjb25zb2xlIiwibG9nIiwibGVuZ3RoIiwiRXJyb3IiLCJmaWxlUHJvbWlzZXMiLCJtYXAiLCJmaWxlTmFtZSIsImxvYWRBdWRpb0ZpbGUiLCJQcm9taXNlIiwiYWxsIiwiZm9yRWFjaCIsImJ1ZmZlciIsInNvdXJjZU5vZGUiLCJjcmVhdGVCdWZmZXJTb3VyY2UiLCJnYWluTm9kZSIsImNyZWF0ZUdhaW4iLCJnYWluIiwidmFsdWUiLCJjb25uZWN0IiwiZGVzdGluYXRpb24iLCJwdXNoIiwibG9vcCIsInN0YXJ0IiwidXJsIiwicmVzcG9uc2UiLCJmZXRjaCIsImFycmF5QnVmZmVyIiwiZGVjb2RlQXVkaW9EYXRhIiwidW5NdXRlVHJhY2siLCJ0cmFja051bWJlciIsIm11dGVUcmFjayIsIm11dGVBbGwiLCJpIiwiaXNJbml0aWF0ZWQiLCJtb2JpbGVVc2FnZSIsImJhbGxIb21lIiwic2hvd0JhbGxzIiwic2hvdyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImJhbGwiLCJzdHlsZSIsImRpc3BsYXkiLCJnZXRTcXVhcmVJZCIsImlkIiwicGFydHMiLCJzcGxpdCIsInBhcnNlSW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsInN0YXJ0QnV0dG9uIiwiZ2V0RWxlbWVudEJ5SWQiLCJyZW1vdmUiLCJtYXRyaXgiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiYm9keSIsImFwcGVuZENoaWxkIiwic3F1YXJlIiwiZHJhZ2dhYmxlIiwiY3JlYXRlVUkiLCJiYWxscyIsInNxdWFyZXMiLCJhY3RpdmVCYWxsIiwib3JpZ2luU3F1YXJlIiwiZHJvcEJhbGwiLCJ0YXJnZXQiLCJlIiwicGFyZW50RWxlbWVudCIsImRhdGFUcmFuc2ZlciIsInNldERhdGEiLCJ0b3VjaGVzIiwicHJldmVudERlZmF1bHQiLCJ0b3VjaCIsImxlZnQiLCJjbGllbnRYIiwidG9wIiwiY2xpZW50WSIsImNoYW5nZWRUb3VjaGVzIiwidGFyZ2V0RWxlbWVudCIsImVsZW1lbnRGcm9tUG9pbnQiLCJpbml0VUkiLCJhc3luYyIsImNyZWF0ZVN0YXJ0QnV0dG9uIl0sInNvdXJjZVJvb3QiOiIifQ==