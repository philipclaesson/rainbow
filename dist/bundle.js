(()=>{"use strict";const e=new class{audioContext;tracks=[];slowAverage=39;constructor(){this.audioContext=new AudioContext}async initAudio(e){if(16!==e.length)throw new Error("Expected 16 audio files.");const t=e.map((e=>this.loadAudioFile(e)));(await Promise.all(t)).forEach((e=>{const t=this.audioContext.createBufferSource(),n=this.audioContext.createGain();t.buffer=e,n.gain.value=0;const a=this.audioContext.createAnalyser();a.fftSize=2048,n.connect(a),t.connect(n),n.connect(this.audioContext.destination),this.tracks.push({sourceNode:t,gainNode:n,analyserNode:a}),t.loop=!0,t.start(0)}))}async loadAudioFile(e){const t=await fetch(e),n=await t.arrayBuffer();return this.audioContext.decodeAudioData(n)}getNoiseColor(e){const t=this.tracks[e].analyserNode,n=new Uint8Array(t.frequencyBinCount);t.getByteFrequencyData(n);const a=n.reduce(((e,t)=>e+t),0)/n.length;return`hsl(${Math.min(100+5*a,240)}, 100%, 50%)`}getFrequencyColor(e){if(0===this.tracks[e].gainNode.gain.value)return`hsl(${this.slowAverage+e}, 100%, 50%)`;const t=this.tracks[e].analyserNode,n=new Uint8Array(t.frequencyBinCount);t.getByteFrequencyData(n);const a=Math.max(...n),o=n.indexOf(a);return this.updateSlowAverage(o),`hsl(${this.slowAverage+e+5*o%240}, 100%, 50%)`}updateSlowAverage(e){this.slowAverage=this.slowAverage+.001*e%240}unMuteTrack(e){if(-1!=e){if(!this.tracks[e])throw new Error(`Track ${e} does not exist.`);this.tracks[e].gainNode.gain.value=1}}muteTrack(e){if(-1!=e){if(!this.tracks[e])throw new Error(`Track ${e} does not exist.`);this.tracks[e].gainNode.gain.value=0}}muteAll(){for(let e=0;e<this.tracks.length;e++)this.muteTrack(e)}},t=16;var n=!1,a=!1,o=null;function s(e){document.querySelectorAll(".ball").forEach((t=>{t.style.display=e?"block":"none"}))}function r(e){if(!e)return-1;const t=e.split("square-");return t.length<2?-1:parseInt(t[1])}function i(e){if(e){const e=document.createElement("div");e.classList.add("spinner"),e.id="spinner",document.body.appendChild(e)}else{const e=document.getElementById("spinner");e?.remove()}}function d(){if(requestAnimationFrame(d),n)for(let n=0;n<t;n++){const t=document.getElementById(`square-${n}`);t&&(t.style.backgroundColor=e.getFrequencyColor(n))}}document.addEventListener("DOMContentLoaded",(()=>{!function(){const c=document.getElementById("start-button"),l=document.getElementById("info");c?.addEventListener("click",(async()=>{c.remove(),l?.remove(),i(!0),await async function(){n||(await e.initAudio(["stems/drums.wav","stems/hats.wav","stems/kick-hat.wav","stems/toms.wav","stems/acid-and-chord.wav","stems/bass.wav","stems/drums.wav","stems/hats.wav","stems/kick-hat.wav","stems/toms.wav","stems/acid-and-chord.wav","stems/bass.wav","stems/drums.wav","stems/hats.wav","stems/kick-hat.wav","stems/toms.wav"]),n=!0)}(),i(!1),function(){const e=document.createElement("div");e.classList.add("matrix"),e.id="matrix",document.body.appendChild(e);for(let n=0;n<t;n++){const t=document.createElement("div");t.classList.add("square"),t.id=`square-${n}`,e.appendChild(t)}(o=document.createElement("div")).classList.add("ballhome"),o.id="ballhome",document.body.appendChild(o);for(let e=0;e<3;e++){const t=document.createElement("div");t.classList.add("ball"),t.id=`ball-${e}`,t.draggable=!0,t.innerText="ðŸŒˆ",o.appendChild(t)}}(),function(){const t=document.querySelectorAll(".ball"),n=document.querySelectorAll(".square");let i=null,d=null;const c=t=>{i&&(console.log("Dropped:",i.id,t.id),e.unMuteTrack(r(t.id)),t.appendChild(i),d=null,i.style.display="block",i=null)};if(t.forEach((t=>{t.addEventListener("dragstart",(n=>{i=t,d=t.parentElement,n.dataTransfer?.setData("text/plain",t.id),console.log("[Dragstart]: Lifted",t.id,"from",d.id),e.muteTrack(r(d.id))})),t.addEventListener("touchstart",(n=>{a=!0,i=t,d=t.parentElement,console.log("[Touchstart] Lifted",t.id,"from",d.id),e.muteTrack(r(d.id))})),t.addEventListener("touchmove",(e=>{if(console.log("[Touchmove] Dragging",t.id,e.touches.length),e.preventDefault(),a=!0,1===e.touches.length){const n=e.touches[0];t.style.left=n.clientX-25+"px",t.style.top=n.clientY-25+"px"}})),t.addEventListener("touchend",(e=>{if(console.log("[Touchend] Dropped",t.id),!i)return;s(!1);const n=e.changedTouches[0],a=document.elementFromPoint(n.clientX,n.clientY);s(!0),c(a)}))})),n.forEach((e=>{e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(t=>{t.preventDefault(),c(e)}))})),!o)throw new Error("Ball home not found");o.addEventListener("dragover",(e=>{e.preventDefault()})),o.addEventListener("drop",(e=>{if(e.preventDefault(),!o)throw new Error("Ball home not found");c(o)})),document.addEventListener("dragover",(e=>{a||e.preventDefault()})),document.addEventListener("drop",(e=>{if(!a){const e=document.getElementById("ballhome");c(e)}}))}(),d()}))}()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TSxJQUFJckQsTUFBTSx1QkFFbEJxRCxFQUFTeUIsaUJBQWlCLFlBQWFnQixJQUNyQ0EsRUFBRUssZ0JBQWdCLElBR3BCOUMsRUFBU3lCLGlCQUFpQixRQUFTZ0IsSUFFakMsR0FEQUEsRUFBRUssa0JBQ0c5QyxFQUNILE1BQU0sSUFBSXJELE1BQU0sdUJBRWxCMEYsRUFBU3JDLEVBQVMsSUFHcEJHLFNBQVNzQixpQkFBaUIsWUFBYWdCLElBQ2hDMUMsR0FDSDBDLEVBQUVLLGdCLElBR04zQyxTQUFTc0IsaUJBQWlCLFFBQVNnQixJQUNqQyxJQUFLMUMsRUFBYSxDQUNoQixNQUFNQyxFQUFXRyxTQUFTZ0IsZUFBZSxZQUN6Q2tCLEVBQVNyQyxFLElBR2YsQ0FvRUl1RCxHQUNBbEMsR0FBTSxHQUVWLENBR0VtQyxFQUFtQixHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3F1YXJlcy8uL3NyYy9tYWluLnRzIiwid2VicGFjazovL3NxdWFyZXMvLi9zcmMvYXVkaW8udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXVkaW9Db250cm9sbGVyIH0gZnJvbSBcIi4vYXVkaW9cIjtcblxuY29uc3QgYWMgPSBuZXcgQXVkaW9Db250cm9sbGVyKCk7XG5jb25zdCBuU3F1YXJlcyA9IDE2O1xuY29uc3QgbkJhbGxzID0gMztcbnZhciBpc1BsYXlpbmcgPSBmYWxzZTtcbnZhciBpc0luaXRpYXRlZCA9IGZhbHNlO1xudmFyIG1vYmlsZVVzYWdlID0gZmFsc2U7XG52YXIgYmFsbEhvbWU6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG5cbmZ1bmN0aW9uIGNyZWF0ZVVJKCkge1xuICBjb25zdCBtYXRyaXggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBtYXRyaXguY2xhc3NMaXN0LmFkZChcIm1hdHJpeFwiKTtcbiAgbWF0cml4LmlkID0gXCJtYXRyaXhcIjtcbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtYXRyaXgpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IG5TcXVhcmVzOyBpKyspIHtcbiAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKFwic3F1YXJlXCIpO1xuICAgIHNxdWFyZS5pZCA9IGBzcXVhcmUtJHtpfWA7XG4gICAgbWF0cml4LmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gIH1cbiAgYmFsbEhvbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBiYWxsSG9tZS5jbGFzc0xpc3QuYWRkKFwiYmFsbGhvbWVcIik7XG4gIGJhbGxIb21lLmlkID0gXCJiYWxsaG9tZVwiO1xuICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGJhbGxIb21lKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IG5CYWxsczsgaSsrKSB7XG4gICAgY29uc3QgYmFsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgYmFsbC5jbGFzc0xpc3QuYWRkKFwiYmFsbFwiKTtcbiAgICBiYWxsLmlkID0gYGJhbGwtJHtpfWA7XG4gICAgYmFsbC5kcmFnZ2FibGUgPSB0cnVlO1xuICAgIGJhbGwuaW5uZXJUZXh0ID0gYPCfjIhgO1xuICAgIGJhbGxIb21lLmFwcGVuZENoaWxkKGJhbGwpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGluaXRVSSgpIHtcbiAgY29uc3QgYmFsbHM6IE5vZGVMaXN0T2Y8SFRNTEVsZW1lbnQ+ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5iYWxsXCIpO1xuICBjb25zdCBzcXVhcmVzOiBOb2RlTGlzdE9mPEhUTUxFbGVtZW50PiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc3F1YXJlXCIpO1xuICBsZXQgYWN0aXZlQmFsbDogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgbGV0IG9yaWdpblNxdWFyZTogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcblxuICBjb25zdCBkcm9wQmFsbCA9ICh0YXJnZXQ6IEhUTUxFbGVtZW50KSA9PiB7XG4gICAgaWYgKGFjdGl2ZUJhbGwpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiRHJvcHBlZDpcIiwgYWN0aXZlQmFsbC5pZCwgdGFyZ2V0LmlkKTtcbiAgICAgIGFjLnVuTXV0ZVRyYWNrKGdldFNxdWFyZUlkKHRhcmdldC5pZCkpO1xuICAgICAgdGFyZ2V0LmFwcGVuZENoaWxkKGFjdGl2ZUJhbGwpO1xuICAgICAgb3JpZ2luU3F1YXJlID0gbnVsbDtcbiAgICAgIGFjdGl2ZUJhbGwuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjsgLy8gTWFrZSBzdXJlIHRvIGRpc3BsYXkgdGhlIGJhbGwgYWdhaW5cbiAgICAgIGFjdGl2ZUJhbGwgPSBudWxsO1xuICAgIH1cbiAgfTtcblxuICBiYWxscy5mb3JFYWNoKChiYWxsKSA9PiB7XG4gICAgYmFsbC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ3N0YXJ0XCIsIChlOiBEcmFnRXZlbnQpID0+IHtcbiAgICAgIGFjdGl2ZUJhbGwgPSBiYWxsO1xuICAgICAgb3JpZ2luU3F1YXJlID0gYmFsbC5wYXJlbnRFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xuICAgICAgZS5kYXRhVHJhbnNmZXI/LnNldERhdGEoXCJ0ZXh0L3BsYWluXCIsIGJhbGwuaWQpO1xuICAgICAgY29uc29sZS5sb2coXCJbRHJhZ3N0YXJ0XTogTGlmdGVkXCIsIGJhbGwuaWQsIFwiZnJvbVwiLCBvcmlnaW5TcXVhcmUuaWQpO1xuICAgICAgYWMubXV0ZVRyYWNrKGdldFNxdWFyZUlkKG9yaWdpblNxdWFyZS5pZCkpO1xuICAgIH0pO1xuXG4gICAgYmFsbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCAoZTogVG91Y2hFdmVudCkgPT4ge1xuICAgICAgbW9iaWxlVXNhZ2UgPSB0cnVlO1xuICAgICAgYWN0aXZlQmFsbCA9IGJhbGw7XG4gICAgICBvcmlnaW5TcXVhcmUgPSBiYWxsLnBhcmVudEVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICBjb25zb2xlLmxvZyhcIltUb3VjaHN0YXJ0XSBMaWZ0ZWRcIiwgYmFsbC5pZCwgXCJmcm9tXCIsIG9yaWdpblNxdWFyZS5pZCk7XG4gICAgICBhYy5tdXRlVHJhY2soZ2V0U3F1YXJlSWQob3JpZ2luU3F1YXJlLmlkKSk7XG4gICAgfSk7XG5cbiAgICBiYWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaG1vdmVcIiwgKGU6IFRvdWNoRXZlbnQpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKFwiW1RvdWNobW92ZV0gRHJhZ2dpbmdcIiwgYmFsbC5pZCwgZS50b3VjaGVzLmxlbmd0aCk7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBtb2JpbGVVc2FnZSA9IHRydWU7XG4gICAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBjb25zdCB0b3VjaCA9IGUudG91Y2hlc1swXTtcbiAgICAgICAgYmFsbC5zdHlsZS5sZWZ0ID0gYCR7dG91Y2guY2xpZW50WCAtIDI1fXB4YDsgLy8gQWRqdXN0IGZvciBjZW50ZXIgb2YgdGhlIGJhbGxcbiAgICAgICAgYmFsbC5zdHlsZS50b3AgPSBgJHt0b3VjaC5jbGllbnRZIC0gMjV9cHhgO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgYmFsbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgKGU6IFRvdWNoRXZlbnQpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKFwiW1RvdWNoZW5kXSBEcm9wcGVkXCIsIGJhbGwuaWQpO1xuICAgICAgaWYgKCFhY3RpdmVCYWxsKSByZXR1cm47XG4gICAgICBzaG93QmFsbHMoZmFsc2UpO1xuICAgICAgY29uc3QgdG91Y2ggPSBlLmNoYW5nZWRUb3VjaGVzWzBdO1xuICAgICAgY29uc3QgdGFyZ2V0RWxlbWVudCA9IGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQoXG4gICAgICAgIHRvdWNoLmNsaWVudFgsXG4gICAgICAgIHRvdWNoLmNsaWVudFlcbiAgICAgICkgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICBzaG93QmFsbHModHJ1ZSk7XG4gICAgICBkcm9wQmFsbCh0YXJnZXRFbGVtZW50KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgc3F1YXJlcy5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIChlOiBEcmFnRXZlbnQpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcblxuICAgIHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCAoZTogRHJhZ0V2ZW50KSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBkcm9wQmFsbChzcXVhcmUpO1xuICAgIH0pO1xuICB9KTtcblxuICBpZiAoIWJhbGxIb21lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQmFsbCBob21lIG5vdCBmb3VuZFwiKTtcbiAgfVxuICBiYWxsSG9tZS5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ292ZXJcIiwgKGU6IERyYWdFdmVudCkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgfSk7XG5cbiAgYmFsbEhvbWUuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgKGU6IERyYWdFdmVudCkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBpZiAoIWJhbGxIb21lKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWxsIGhvbWUgbm90IGZvdW5kXCIpO1xuICAgIH1cbiAgICBkcm9wQmFsbChiYWxsSG9tZSk7XG4gIH0pO1xuXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCAoZSkgPT4ge1xuICAgIGlmICghbW9iaWxlVXNhZ2UpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTsgLy8gVGhpcyBhbGxvd3MgdGhlIGRyb3AgdG8gYmUgYWNjZXB0ZWQuXG4gICAgfVxuICB9KTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgKGUpID0+IHtcbiAgICBpZiAoIW1vYmlsZVVzYWdlKSB7XG4gICAgICBjb25zdCBiYWxsSG9tZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYmFsbGhvbWVcIikgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICBkcm9wQmFsbChiYWxsSG9tZSk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gc2hvd0JhbGxzKHNob3c6IGJvb2xlYW4pIHtcbiAgY29uc3QgYmFsbHM6IE5vZGVMaXN0T2Y8SFRNTEVsZW1lbnQ+ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5iYWxsXCIpO1xuICBiYWxscy5mb3JFYWNoKChiYWxsKSA9PiB7XG4gICAgYmFsbC5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/IFwiYmxvY2tcIiA6IFwibm9uZVwiO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0U3F1YXJlSWQoaWQ6IHN0cmluZyB8IG51bGwpOiBudW1iZXIge1xuICBpZiAoIWlkKSB7XG4gICAgcmV0dXJuIC0xO1xuICB9XG4gIGNvbnN0IHBhcnRzID0gaWQuc3BsaXQoXCJzcXVhcmUtXCIpO1xuICBpZiAocGFydHMubGVuZ3RoIDwgMikge1xuICAgIHJldHVybiAtMTtcbiAgfVxuICByZXR1cm4gcGFyc2VJbnQocGFydHNbMV0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBpbml0QXVkaW8oKSB7XG4gIGlmIChpc0luaXRpYXRlZCkge1xuICAgIHJldHVybjtcbiAgfVxuICBhd2FpdCBhYy5pbml0QXVkaW8oW1xuICAgIFwic3RlbXMvZHJ1bXMud2F2XCIsXG4gICAgXCJzdGVtcy9oYXRzLndhdlwiLFxuICAgIFwic3RlbXMva2ljay1oYXQud2F2XCIsXG4gICAgXCJzdGVtcy90b21zLndhdlwiLFxuICAgIFwic3RlbXMvYWNpZC1hbmQtY2hvcmQud2F2XCIsXG4gICAgXCJzdGVtcy9iYXNzLndhdlwiLFxuICAgIFwic3RlbXMvZHJ1bXMud2F2XCIsXG4gICAgXCJzdGVtcy9oYXRzLndhdlwiLFxuICAgIFwic3RlbXMva2ljay1oYXQud2F2XCIsXG4gICAgXCJzdGVtcy90b21zLndhdlwiLFxuICAgIFwic3RlbXMvYWNpZC1hbmQtY2hvcmQud2F2XCIsXG4gICAgXCJzdGVtcy9iYXNzLndhdlwiLFxuICAgIFwic3RlbXMvZHJ1bXMud2F2XCIsXG4gICAgXCJzdGVtcy9oYXRzLndhdlwiLFxuICAgIFwic3RlbXMva2ljay1oYXQud2F2XCIsXG4gICAgXCJzdGVtcy90b21zLndhdlwiLFxuICBdKTtcbiAgaXNJbml0aWF0ZWQgPSB0cnVlO1xufVxuXG5mdW5jdGlvbiBzcGlubmVyKHNob3c6IGJvb2xlYW4pIHtcbiAgaWYgKHNob3cpIHtcbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIHNwaW5uZXIuY2xhc3NMaXN0LmFkZChcInNwaW5uZXJcIik7XG4gICAgc3Bpbm5lci5pZCA9IFwic3Bpbm5lclwiO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3Bpbm5lclwiKTtcbiAgICBzcGlubmVyPy5yZW1vdmUoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVTdGFydEJ1dHRvbigpIHtcbiAgY29uc3Qgc3RhcnRCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXJ0LWJ1dHRvblwiKTtcbiAgY29uc3QgaW5mbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaW5mb1wiKTtcbiAgc3RhcnRCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgc3RhcnRCdXR0b24ucmVtb3ZlKCk7XG4gICAgaW5mbz8ucmVtb3ZlKCk7XG4gICAgc3Bpbm5lcih0cnVlKTtcbiAgICBhd2FpdCBpbml0QXVkaW8oKTtcbiAgICBzcGlubmVyKGZhbHNlKTtcbiAgICBjcmVhdGVVSSgpO1xuICAgIGluaXRVSSgpO1xuICAgIGRyYXcoKTtcbiAgfSk7XG59XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcbiAgY3JlYXRlU3RhcnRCdXR0b24oKTtcbn0pO1xuXG5mdW5jdGlvbiBkcmF3KCkge1xuICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZHJhdyk7XG4gIGlmICghaXNJbml0aWF0ZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuU3F1YXJlczsgaSsrKSB7XG4gICAgY29uc3Qgc3F1YXJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHNxdWFyZS0ke2l9YCkgYXMgSFRNTEVsZW1lbnQ7XG4gICAgaWYgKHNxdWFyZSkge1xuICAgICAgc3F1YXJlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGFjLmdldEZyZXF1ZW5jeUNvbG9yKGkpO1xuICAgIH1cbiAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIEF1ZGlvQ29udHJvbGxlciB7XG4gIHByaXZhdGUgYXVkaW9Db250ZXh0OiBBdWRpb0NvbnRleHQ7XG4gIHByaXZhdGUgdHJhY2tzOiB7XG4gICAgc291cmNlTm9kZTogQXVkaW9CdWZmZXJTb3VyY2VOb2RlO1xuICAgIGdhaW5Ob2RlOiBHYWluTm9kZTtcbiAgICBhbmFseXNlck5vZGU6IEFuYWx5c2VyTm9kZTtcbiAgfVtdID0gW107XG4gIHByaXZhdGUgc2xvd0F2ZXJhZ2U6IG51bWJlciA9IDM5OyAvLyBvcmFuZ2VcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmF1ZGlvQ29udGV4dCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcbiAgfVxuXG4gIGFzeW5jIGluaXRBdWRpbyhmaWxlTmFtZXM6IHN0cmluZ1tdKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKGZpbGVOYW1lcy5sZW5ndGggIT09IDE2KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFeHBlY3RlZCAxNiBhdWRpbyBmaWxlcy5cIik7XG4gICAgfVxuXG4gICAgY29uc3QgZmlsZVByb21pc2VzID0gZmlsZU5hbWVzLm1hcCgoZmlsZU5hbWUpID0+XG4gICAgICB0aGlzLmxvYWRBdWRpb0ZpbGUoZmlsZU5hbWUpXG4gICAgKTtcblxuICAgIGNvbnN0IGF1ZGlvQnVmZmVycyA9IGF3YWl0IFByb21pc2UuYWxsKGZpbGVQcm9taXNlcyk7XG5cbiAgICBhdWRpb0J1ZmZlcnMuZm9yRWFjaCgoYnVmZmVyKSA9PiB7XG4gICAgICBjb25zdCBzb3VyY2VOb2RlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gICAgICBjb25zdCBnYWluTm9kZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUdhaW4oKTtcblxuICAgICAgc291cmNlTm9kZS5idWZmZXIgPSBidWZmZXI7XG4gICAgICBnYWluTm9kZS5nYWluLnZhbHVlID0gMDsgLy8gU3RhcnQgbXV0ZWRcblxuICAgICAgLy8gc2V0IHVwIGFuIGFuYWx5c2VyIHNvIHdlIGNhbiBkbyBjb29sIHZpc3VhbHNcbiAgICAgIGNvbnN0IGFuYWx5c2VyTm9kZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUFuYWx5c2VyKCk7XG4gICAgICBhbmFseXNlck5vZGUuZmZ0U2l6ZSA9IDIwNDg7XG4gICAgICBnYWluTm9kZS5jb25uZWN0KGFuYWx5c2VyTm9kZSk7XG5cbiAgICAgIHNvdXJjZU5vZGUuY29ubmVjdChnYWluTm9kZSk7XG4gICAgICBnYWluTm9kZS5jb25uZWN0KHRoaXMuYXVkaW9Db250ZXh0LmRlc3RpbmF0aW9uKTtcblxuICAgICAgdGhpcy50cmFja3MucHVzaCh7IHNvdXJjZU5vZGUsIGdhaW5Ob2RlLCBhbmFseXNlck5vZGUgfSk7XG5cbiAgICAgIHNvdXJjZU5vZGUubG9vcCA9IHRydWU7XG4gICAgICBzb3VyY2VOb2RlLnN0YXJ0KDApOyAvLyBQbGF5IGltbWVkaWF0ZWx5IGluIHN5bmNcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9hZEF1ZGlvRmlsZSh1cmw6IHN0cmluZyk6IFByb21pc2U8QXVkaW9CdWZmZXI+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpO1xuICAgIHJldHVybiB0aGlzLmF1ZGlvQ29udGV4dC5kZWNvZGVBdWRpb0RhdGEoYXJyYXlCdWZmZXIpO1xuICB9XG5cbiAgZ2V0Tm9pc2VDb2xvcih0cmFjazogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBjb25zdCBhbmFseXNlck5vZGUgPSB0aGlzLnRyYWNrc1t0cmFja10uYW5hbHlzZXJOb2RlO1xuICAgIGNvbnN0IGRhdGFBcnJheSA9IG5ldyBVaW50OEFycmF5KGFuYWx5c2VyTm9kZS5mcmVxdWVuY3lCaW5Db3VudCk7XG4gICAgYW5hbHlzZXJOb2RlLmdldEJ5dGVGcmVxdWVuY3lEYXRhKGRhdGFBcnJheSk7XG5cbiAgICBjb25zdCBhdmVyYWdlID1cbiAgICAgIGRhdGFBcnJheS5yZWR1Y2UoKGFjYywgdmFsKSA9PiBhY2MgKyB2YWwsIDApIC8gZGF0YUFycmF5Lmxlbmd0aDtcbiAgICBjb25zdCBodWUgPSBNYXRoLm1pbigxMDAgKyBhdmVyYWdlICogNSwgMjQwKTtcbiAgICByZXR1cm4gYGhzbCgke2h1ZX0sIDEwMCUsIDUwJSlgO1xuICB9XG5cbiAgZ2V0RnJlcXVlbmN5Q29sb3IodHJhY2s6IG51bWJlcik6IHN0cmluZyB7XG4gICAgY29uc3QgZ2Fpbk5vZGUgPSB0aGlzLnRyYWNrc1t0cmFja10uZ2Fpbk5vZGU7XG4gICAgaWYgKGdhaW5Ob2RlLmdhaW4udmFsdWUgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGBoc2woJHt0aGlzLnNsb3dBdmVyYWdlICsgdHJhY2t9LCAxMDAlLCA1MCUpYDtcbiAgICB9XG4gICAgY29uc3QgYW5hbHlzZXJOb2RlID0gdGhpcy50cmFja3NbdHJhY2tdLmFuYWx5c2VyTm9kZTtcbiAgICBjb25zdCBkYXRhQXJyYXkgPSBuZXcgVWludDhBcnJheShhbmFseXNlck5vZGUuZnJlcXVlbmN5QmluQ291bnQpO1xuICAgIGFuYWx5c2VyTm9kZS5nZXRCeXRlRnJlcXVlbmN5RGF0YShkYXRhQXJyYXkpO1xuXG4gICAgLy8gZ2V0IHRoZSBoaWdoZXN0IGZyZXF1ZW5jeVxuICAgIGNvbnN0IG1heCA9IE1hdGgubWF4KC4uLmRhdGFBcnJheSk7XG4gICAgY29uc3QgbWF4SW5kZXggPSBkYXRhQXJyYXkuaW5kZXhPZihtYXgpO1xuICAgIHRoaXMudXBkYXRlU2xvd0F2ZXJhZ2UobWF4SW5kZXgpO1xuXG4gICAgY29uc3QgaHVlID0gdGhpcy5zbG93QXZlcmFnZSArIHRyYWNrICsgbWF4SW5kZXggKiA1ICUgMjQwXG4gICAgcmV0dXJuIGBoc2woJHtodWV9LCAxMDAlLCA1MCUpYDtcbiAgfVxuXG4gIHVwZGF0ZVNsb3dBdmVyYWdlKHZhbHVlOiBudW1iZXIpIHtcbiAgICB0aGlzLnNsb3dBdmVyYWdlID0gdGhpcy5zbG93QXZlcmFnZSArIHZhbHVlICogMC4wMDEgJSAyNDA7XG4gIH1cblxuICB1bk11dGVUcmFjayh0cmFja051bWJlcjogbnVtYmVyKTogdm9pZCB7XG4gICAgaWYgKHRyYWNrTnVtYmVyID09IC0xKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLnRyYWNrc1t0cmFja051bWJlcl0pIHtcbiAgICAgIHRoaXMudHJhY2tzW3RyYWNrTnVtYmVyXS5nYWluTm9kZS5nYWluLnZhbHVlID0gMTsgLy8gU2V0IGdhaW4gdG8gMSB0byB1bm11dGVcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUcmFjayAke3RyYWNrTnVtYmVyfSBkb2VzIG5vdCBleGlzdC5gKTtcbiAgICB9XG4gIH1cblxuICBtdXRlVHJhY2sodHJhY2tOdW1iZXI6IG51bWJlcik6IHZvaWQge1xuICAgIGlmICh0cmFja051bWJlciA9PSAtMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy50cmFja3NbdHJhY2tOdW1iZXJdKSB7XG4gICAgICB0aGlzLnRyYWNrc1t0cmFja051bWJlcl0uZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IDA7IC8vIFNldCBnYWluIHRvIDAgdG8gbXV0ZVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRyYWNrICR7dHJhY2tOdW1iZXJ9IGRvZXMgbm90IGV4aXN0LmApO1xuICAgIH1cbiAgfVxuXG4gIG11dGVBbGwoKTogdm9pZCB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRyYWNrcy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5tdXRlVHJhY2soaSk7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOlsiYWMiLCJhdWRpb0NvbnRleHQiLCJ0cmFja3MiLCJzbG93QXZlcmFnZSIsImNvbnN0cnVjdG9yIiwidGhpcyIsIkF1ZGlvQ29udGV4dCIsImluaXRBdWRpbyIsImZpbGVOYW1lcyIsImxlbmd0aCIsIkVycm9yIiwiZmlsZVByb21pc2VzIiwibWFwIiwiZmlsZU5hbWUiLCJsb2FkQXVkaW9GaWxlIiwiUHJvbWlzZSIsImFsbCIsImZvckVhY2giLCJidWZmZXIiLCJzb3VyY2VOb2RlIiwiY3JlYXRlQnVmZmVyU291cmNlIiwiZ2Fpbk5vZGUiLCJjcmVhdGVHYWluIiwiZ2FpbiIsInZhbHVlIiwiYW5hbHlzZXJOb2RlIiwiY3JlYXRlQW5hbHlzZXIiLCJmZnRTaXplIiwiY29ubmVjdCIsImRlc3RpbmF0aW9uIiwicHVzaCIsImxvb3AiLCJzdGFydCIsInVybCIsInJlc3BvbnNlIiwiZmV0Y2giLCJhcnJheUJ1ZmZlciIsImRlY29kZUF1ZGlvRGF0YSIsImdldE5vaXNlQ29sb3IiLCJ0cmFjayIsImRhdGFBcnJheSIsIlVpbnQ4QXJyYXkiLCJmcmVxdWVuY3lCaW5Db3VudCIsImdldEJ5dGVGcmVxdWVuY3lEYXRhIiwiYXZlcmFnZSIsInJlZHVjZSIsImFjYyIsInZhbCIsIk1hdGgiLCJtaW4iLCJnZXRGcmVxdWVuY3lDb2xvciIsIm1heCIsIm1heEluZGV4IiwiaW5kZXhPZiIsInVwZGF0ZVNsb3dBdmVyYWdlIiwidW5NdXRlVHJhY2siLCJ0cmFja051bWJlciIsIm11dGVUcmFjayIsIm11dGVBbGwiLCJpIiwiblNxdWFyZXMiLCJpc0luaXRpYXRlZCIsIm1vYmlsZVVzYWdlIiwiYmFsbEhvbWUiLCJzaG93QmFsbHMiLCJzaG93IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiYmFsbCIsInN0eWxlIiwiZGlzcGxheSIsImdldFNxdWFyZUlkIiwiaWQiLCJwYXJ0cyIsInNwbGl0IiwicGFyc2VJbnQiLCJzcGlubmVyIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImdldEVsZW1lbnRCeUlkIiwicmVtb3ZlIiwiZHJhdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInNxdWFyZSIsImJhY2tncm91bmRDb2xvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJzdGFydEJ1dHRvbiIsImluZm8iLCJhc3luYyIsIm1hdHJpeCIsImRyYWdnYWJsZSIsImlubmVyVGV4dCIsImNyZWF0ZVVJIiwiYmFsbHMiLCJzcXVhcmVzIiwiYWN0aXZlQmFsbCIsIm9yaWdpblNxdWFyZSIsImRyb3BCYWxsIiwidGFyZ2V0IiwiY29uc29sZSIsImxvZyIsImUiLCJwYXJlbnRFbGVtZW50IiwiZGF0YVRyYW5zZmVyIiwic2V0RGF0YSIsInRvdWNoZXMiLCJwcmV2ZW50RGVmYXVsdCIsInRvdWNoIiwibGVmdCIsImNsaWVudFgiLCJ0b3AiLCJjbGllbnRZIiwiY2hhbmdlZFRvdWNoZXMiLCJ0YXJnZXRFbGVtZW50IiwiZWxlbWVudEZyb21Qb2ludCIsImluaXRVSSIsImNyZWF0ZVN0YXJ0QnV0dG9uIl0sInNvdXJjZVJvb3QiOiIifQ==