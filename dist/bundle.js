(()=>{"use strict";const e=new class{audioContext;tracks=[];slowAverage=39;fx1a=null;fx1b=null;constructor(){this.audioContext=new AudioContext}async initAudio(e){if(16!==e.length)throw new Error("Expected 16 audio files.");const t=e.map((e=>this.loadAudioFile(e)));(await Promise.all(t)).forEach((e=>{const t=this.audioContext.createBufferSource(),n=this.audioContext.createGain();t.buffer=e,n.gain.value=0,t.connect(n);const o=this.audioContext.createAnalyser();o.fftSize=2048,n.connect(o),this.fx1a=this.audioContext.createBiquadFilter(),this.fx1a.type="highpass",this.fx1a.frequency.value=1e3,this.fx1a.gain.value=0,n.connect(this.fx1a),this.fx1b=this.audioContext.createDelay(),this.fx1b.delayTime.value=0,this.fx1a.connect(this.fx1b),n.connect(this.audioContext.destination),this.tracks.push({sourceNode:t,gainNode:n,analyserNode:o}),t.loop=!0,t.start(0)}))}async loadAudioFile(e){const t=await fetch(e),n=await t.arrayBuffer();return this.audioContext.decodeAudioData(n)}getFrequencyColor(e){if(0===this.tracks[e].gainNode.gain.value)return`hsl(${this.slowAverage+e}, 100%, 50%)`;const t=this.tracks[e].analyserNode,n=new Uint8Array(t.frequencyBinCount);t.getByteFrequencyData(n);const o=Math.max(...n),s=n.indexOf(o);return this.updateSlowAverage(s),`hsl(${this.slowAverage+e+10*s%240}, 100%, 50%)`}updateSlowAverage(e){this.slowAverage=this.slowAverage+.001*e%240}enableTrack(e,t){if(-1!=e){if(e>=this.tracks.length)throw new Error(`Track ${e} does not exist.`);console.log("Enabling track",e,t),this.tracks[e].gainNode.gain.value=t?.5:0}}muteAll(){for(let e=0;e<this.tracks.length;e++)this.enableTrack(e,!1)}fx1(e,t){if(0!=e&&0!=t&&Math.random()>.1)return;if(!this.fx1a||!this.fx1b)return;console.log("fx1 called with x:",e,"y:",t),console.log("AudioContext state:",this.audioContext.state),console.log("Current time:",this.audioContext.currentTime),console.log("Applying gain:",25*e,"to fx1a");const n=Math.floor(10*e);this.fx1a.gain.setValueAtTime(n,this.audioContext.currentTime),this.fx1b.delayTime.setValueAtTime(t,this.audioContext.currentTime),console.log(this.fx1a,this.fx1b)}},t=16;var n=!1;function o(e){if("undefined"!=typeof TouchEvent&&e instanceof TouchEvent&&(e.touches||e.changedTouches)){const t=e.touches.length>0?e.touches:e.changedTouches;return{x:t[0].clientX,y:t[0].clientY}}if(e instanceof MouseEvent)return{x:e.clientX,y:e.clientY};throw new Error("Unsupported event type")}function s(e,t,n,o){const s=document.createElement(e);return s.classList.add(t),s.id=n,o.appendChild(s),s}function i(e){document.querySelectorAll(".ball").forEach((t=>{t.style.display=e?"block":"none"}))}function a(e){if(!e)return-1;const t=e.split("square-");return t.length<2?-1:parseInt(t[1])}function r(e){if(e)s("div","spinner","spinner",document.body);else{const e=document.getElementById("spinner");e?.remove()}}function c(){const c=document.getElementById("start-button"),l=document.getElementById("info-1"),d=document.getElementById("info-2");c?.addEventListener("click",(async()=>{c.remove(),l?.remove(),d?.remove(),r(!0),await async function(){n||(await e.initAudio(["stems/4-on-floor.wav","stems/dnb-124.wav","stems/drums.wav","stems/hats.wav","stems/kick-hat.wav","stems/toms.wav","stems/smooth-chords.wav","stems/bass.wav","stems/bzzz.wav","stems/guitar.wav","stems/dnb-124.wav","stems/drums.wav","stems/hats.wav","stems/keep-on.wav","stems/what-u-doin-to-me.wav","stems/extacy.wav"]),n=!0)}(),r(!1),function(){const e=s("div","matrix","matrix",document.body);for(let n=0;n<t;n++)s("div","square",`square-${n}`,e);const n=s("div","ballhome","ballhome",document.body);for(let e=0;e<4;e++){const t=s("div","ball",`ball-${e}`,n);t.draggable=!0,t.innerText="ðŸŒˆ"}}(),document.querySelectorAll(".ball").forEach((t=>{function n(e){e.preventDefault();const n=t.parentElement;t.setAttribute("origin-square",n.id),t.setAttribute("clicked","true"),console.log(`[${e.type}] Lifted`,t.id,"from",n.id)}function s(e){if(e.preventDefault(),"true"!==t.getAttribute("clicked"))return;const n=o(e);t.style.left=n.x-50+"px",t.style.top=n.y-50+"px"}function r(n){if("true"!==t.getAttribute("clicked"))return;const s=o(n),r=t.getAttribute("origin-square");e.enableTrack(a(r),!1),t.setAttribute("clicked","false"),i(!1);const c=document.elementFromPoint(s.x,s.y);i(!0),((t,n)=>{console.log("Dropped:",t.id,n.id),e.enableTrack(a(n.id),!0),n.appendChild(t)})(t,c),console.log(`[${n.type}] Dropped`,t.id,"from",r)}t.addEventListener("mousedown",n),t.addEventListener("mousemove",s),t.addEventListener("mouseup",r),t.addEventListener("touchstart",n),t.addEventListener("touchmove",s),t.addEventListener("touchend",r)})),u()}))}function u(){if(requestAnimationFrame(u),n)for(let n=0;n<t;n++){const t=document.getElementById(`square-${n}`);t&&(t.style.backgroundColor=e.getFrequencyColor(n))}}document.addEventListener("DOMContentLoaded",(()=>{c()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWpDLEVBQUtlLGlCQUFpQixZQUFhTyxHQUNuQ3RCLEVBQUtlLGlCQUFpQixZQUFhWSxHQUNuQzNCLEVBQUtlLGlCQUFpQixVQUFXaUIsR0FDakNoQyxFQUFLZSxpQkFBaUIsYUFBY08sR0FDcEN0QixFQUFLZSxpQkFBaUIsWUFBYVksR0FDbkMzQixFQUFLZSxpQkFBaUIsV0FBWWlCLEVBQVEsSUF5SjFDTSxHQUFNLEdBRVYsQ0FNQSxTQUFTQSxJQUVQLEdBREFDLHNCQUFzQkQsR0FDakI1RCxFQUdMLElBQUssSUFBSVYsRUFBSSxFQUFHQSxFQUFJUyxFQUFVVCxJQUFLLENBQ2pDLE1BQU13RSxFQUFTL0MsU0FBU2dCLGVBQWUsVUFBVXpDLEtBQzdDd0UsSUFDRkEsRUFBT3ZDLE1BQU13QyxnQkFBa0J2SSxFQUFHNkMsa0JBQWtCaUIsRyxDQUcxRCxDQWZBeUIsU0FBU3NCLGlCQUFpQixvQkFBb0IsS0FDNUNKLEdBQW1CLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zcXVhcmVzLy4vc3JjL21haW4udHMiLCJ3ZWJwYWNrOi8vc3F1YXJlcy8uL3NyYy9hdWRpby50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBdWRpb0NvbnRyb2xsZXIgfSBmcm9tIFwiLi9hdWRpb1wiO1xuXG5jb25zdCBhYyA9IG5ldyBBdWRpb0NvbnRyb2xsZXIoKTtcbmNvbnN0IG5TcXVhcmVzID0gMTY7XG5jb25zdCBuQmFsbHMgPSA0O1xudmFyIGlzSW5pdGlhdGVkID0gZmFsc2U7XG52YXIgZnhFbmFibGUgPSBmYWxzZTtcblxuZnVuY3Rpb24gY3JlYXRlVUlFbGVtZW50cygpIHtcbiAgLy8gQ3JlYXRlIEZYIHVpXG4gIGlmIChmeEVuYWJsZSkge1xuICAgIGNvbnN0IGZ4ZGl2ID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBcImZ4XCIsIFwiZnhcIiwgZG9jdW1lbnQuYm9keSk7XG4gICAgZnhkaXYuc3R5bGUuZGlzcGxheSA9IGZ4RW5hYmxlID8gXCJibG9ja1wiIDogXCJub25lXCI7XG4gICAgY29uc3QgZngxID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBcImZ4MVwiLCBcImZ4MVwiLCBmeGRpdik7XG4gICAgZngxLmlubmVyVGV4dCA9IFwi8J+MilwiO1xuICAgIGNvbnN0IGZ4c3BhY2VyID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBcImZ4c3BhY2VyXCIsIFwiZnhzcGFjZXJcIiwgZnhkaXYpO1xuICAgIGNvbnN0IGZ4MiA9IGNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgXCJmeDJcIiwgXCJmeDJcIiwgZnhkaXYpO1xuICAgIGZ4Mi5pbm5lclRleHQgPSBcIvCflaVcIjtcbiAgfVxuXG4gIGNvbnN0IG1hdHJpeCA9IGNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgXCJtYXRyaXhcIiwgXCJtYXRyaXhcIiwgZG9jdW1lbnQuYm9keSk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgblNxdWFyZXM7IGkrKykge1xuICAgIGNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgXCJzcXVhcmVcIiwgYHNxdWFyZS0ke2l9YCwgbWF0cml4KTtcbiAgfVxuXG4gIGNvbnN0IGJhbGxIb21lID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBcImJhbGxob21lXCIsIFwiYmFsbGhvbWVcIiwgZG9jdW1lbnQuYm9keSk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbkJhbGxzOyBpKyspIHtcbiAgICBjb25zdCBiYWxsID0gY3JlYXRlRWxlbWVudChcImRpdlwiLCBcImJhbGxcIiwgYGJhbGwtJHtpfWAsIGJhbGxIb21lKTtcbiAgICBiYWxsLmRyYWdnYWJsZSA9IHRydWU7XG4gICAgYmFsbC5pbm5lclRleHQgPSBg8J+MiGA7XG4gIH1cbn1cblxuZnVuY3Rpb24gaW5pdFVJTG9naWMoKSB7XG4gIGNvbnN0IGJhbGxzOiBOb2RlTGlzdE9mPEhUTUxFbGVtZW50PiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYmFsbFwiKTtcblxuICAvLyBEcm9wcyBhIGJhbGwgaW50byBhIHRhcmdldCBlbGVtZW50IGFuZCBtdXRlcyB0aGUgdHJhY2sgdGhlIGJhbGwgY2FtZSBmcm9tXG4gIGNvbnN0IGRyb3BCYWxsID0gKGJhbGw6IEhUTUxFbGVtZW50LCB0YXJnZXQ6IEhUTUxFbGVtZW50KSA9PiB7XG4gICAgY29uc29sZS5sb2coXCJEcm9wcGVkOlwiLCBiYWxsLmlkLCB0YXJnZXQuaWQpO1xuICAgIGFjLmVuYWJsZVRyYWNrKGdldFNxdWFyZUlkKHRhcmdldC5pZCksIHRydWUpO1xuICAgIHRhcmdldC5hcHBlbmRDaGlsZChiYWxsKTtcbiAgfTtcblxuICBiYWxscy5mb3JFYWNoKChiYWxsKSA9PiB7XG4gICAgLy8gQ29tbW9uIGZ1bmN0aW9uIGZvciBzdGFydGluZyB0aGUgZHJhZ1xuICAgIGZ1bmN0aW9uIHN0YXJ0RHJhZyhlOiBNb3VzZUV2ZW50IHwgVG91Y2hFdmVudCkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY29uc3Qgb3JpZ2luU3F1YXJlID0gYmFsbC5wYXJlbnRFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xuICAgICAgYmFsbC5zZXRBdHRyaWJ1dGUoXCJvcmlnaW4tc3F1YXJlXCIsIG9yaWdpblNxdWFyZS5pZCk7XG4gICAgICBiYWxsLnNldEF0dHJpYnV0ZShcImNsaWNrZWRcIiwgXCJ0cnVlXCIpO1xuICAgICAgY29uc29sZS5sb2coYFske2UudHlwZX1dIExpZnRlZGAsIGJhbGwuaWQsIFwiZnJvbVwiLCBvcmlnaW5TcXVhcmUuaWQpO1xuICAgIH1cblxuICAgIC8vIENvbW1vbiBmdW5jdGlvbiBmb3IgZHJhZ2dpbmdcbiAgICBmdW5jdGlvbiBkb0RyYWcoZTogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGlmIChiYWxsLmdldEF0dHJpYnV0ZShcImNsaWNrZWRcIikgIT09IFwidHJ1ZVwiKSByZXR1cm47XG4gICAgICBjb25zdCBwb3NpdGlvbiA9IGdldFBvc2l0aW9uRnJvbUV2ZW50KGUpO1xuICAgICAgYmFsbC5zdHlsZS5sZWZ0ID0gYCR7cG9zaXRpb24ueCAtIDUwfXB4YDtcbiAgICAgIGJhbGwuc3R5bGUudG9wID0gYCR7cG9zaXRpb24ueSAtIDUwfXB4YDtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGBbJHtlLnR5cGV9XSBNb3ZpbmcvRHJhZ2dpbmdgLCBiYWxsLmlkKTtcbiAgICB9XG5cbiAgICAvLyBDb21tb24gZnVuY3Rpb24gZm9yIGVuZGluZyB0aGUgZHJhZ1xuICAgIGZ1bmN0aW9uIGVuZERyYWcoZTogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQpIHtcbiAgICAgIGlmIChiYWxsLmdldEF0dHJpYnV0ZShcImNsaWNrZWRcIikgIT09IFwidHJ1ZVwiKSByZXR1cm47XG4gICAgICBjb25zdCBwb3NpdGlvbiA9IGdldFBvc2l0aW9uRnJvbUV2ZW50KGUpO1xuICAgICAgY29uc3Qgb3JpZ2luU3F1YXJlSWQgPSBiYWxsLmdldEF0dHJpYnV0ZShcIm9yaWdpbi1zcXVhcmVcIik7XG4gICAgICBhYy5lbmFibGVUcmFjayhnZXRTcXVhcmVJZChvcmlnaW5TcXVhcmVJZCksIGZhbHNlKTtcbiAgICAgIGJhbGwuc2V0QXR0cmlidXRlKFwiY2xpY2tlZFwiLCBcImZhbHNlXCIpO1xuICAgICAgc2hvd0JhbGxzKGZhbHNlKTtcbiAgICAgIGNvbnN0IHRhcmdldEVsZW1lbnQgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KFxuICAgICAgICBwb3NpdGlvbi54LFxuICAgICAgICBwb3NpdGlvbi55XG4gICAgICApIGFzIEhUTUxFbGVtZW50O1xuICAgICAgc2hvd0JhbGxzKHRydWUpO1xuICAgICAgZHJvcEJhbGwoYmFsbCwgdGFyZ2V0RWxlbWVudCk7XG4gICAgICBjb25zb2xlLmxvZyhgWyR7ZS50eXBlfV0gRHJvcHBlZGAsIGJhbGwuaWQsIFwiZnJvbVwiLCBvcmlnaW5TcXVhcmVJZCk7XG4gICAgfVxuXG4gICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVyc1xuICAgIGJhbGwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBzdGFydERyYWcpO1xuICAgIGJhbGwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBkb0RyYWcpO1xuICAgIGJhbGwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZW5kRHJhZyk7XG4gICAgYmFsbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBzdGFydERyYWcpO1xuICAgIGJhbGwuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCBkb0RyYWcpO1xuICAgIGJhbGwuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGVuZERyYWcpO1xuICB9KTtcbn1cblxuLy8gSGVscGVyIHRvIGV4dHJhY3QgcG9zaXRpb24gZnJvbSBldmVudFxuZnVuY3Rpb24gZ2V0UG9zaXRpb25Gcm9tRXZlbnQoZTogYW55KSB7XG4gIGlmICh0eXBlb2YgVG91Y2hFdmVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgZSBpbnN0YW5jZW9mIFRvdWNoRXZlbnQgJiYgKGUudG91Y2hlcyB8fCBlLmNoYW5nZWRUb3VjaGVzKSkge1xuICAgIGNvbnN0IHRvdWNoZXMgPSBlLnRvdWNoZXMubGVuZ3RoID4gMCA/IGUudG91Y2hlcyA6IGUuY2hhbmdlZFRvdWNoZXM7XG4gICAgcmV0dXJuIHsgeDogdG91Y2hlc1swXS5jbGllbnRYLCB5OiB0b3VjaGVzWzBdLmNsaWVudFkgfTtcbiAgfSBlbHNlIGlmIChlIGluc3RhbmNlb2YgTW91c2VFdmVudCkge1xuICAgIHJldHVybiB7IHg6IGUuY2xpZW50WCwgeTogZS5jbGllbnRZIH07XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVW5zdXBwb3J0ZWQgZXZlbnQgdHlwZVwiKTtcbiAgfVxufVxuXG5cbmZ1bmN0aW9uIGluaXRGWFVJKCkge1xuICBpZiAoIWZ4RW5hYmxlKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGZ4MSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZngxXCIpO1xuICBpZiAoIWZ4MSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcImZ4MSBub3QgZm91bmRcIik7XG4gIH1cbiAgZngxLmRyYWdnYWJsZSA9IHRydWU7XG4gIGNvbnN0IGZ4MiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZngyXCIpO1xuICBmeDE/LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnc3RhcnRcIiwgKGU6IERyYWdFdmVudCkgPT4ge1xuICAgIGNvbnN0IHsgeCwgeSB9ID0gbm9ybWFsaXplZFhZKGUueCwgZS55KTtcbiAgICBhYy5meDEoeCwgeSk7XG4gICAgY29uc29sZS5sb2coXCJkcmFnc3RhcnRcIik7XG4gIH0pO1xuICBmeDE/LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnXCIsIChlOiBEcmFnRXZlbnQpID0+IHtcbiAgICBjb25zdCB7IHgsIHkgfSA9IG5vcm1hbGl6ZWRYWShlLngsIGUueSk7XG4gICAgYWMuZngxKHgsIHkpO1xuICAgIGNvbnNvbGUubG9nKFwiZHJhZ21vdmVcIik7XG4gIH0pO1xuICBmeDE/LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnZW5kXCIsIChlOiBEcmFnRXZlbnQpID0+IHtcbiAgICBhYy5meDEoMCwgMCk7XG4gICAgY29uc29sZS5sb2coXCJkcmFnZW5kXCIpO1xuICB9KTtcbiAgZngxPy5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCAoZTogVG91Y2hFdmVudCkgPT4ge1xuICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoICE9IDEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdG91Y2ggPSBlLnRvdWNoZXNbMF07XG4gICAgY29uc3QgeyB4LCB5IH0gPSBub3JtYWxpemVkWFkodG91Y2guY2xpZW50WCwgdG91Y2guY2xpZW50WSk7XG4gICAgYWMuZngxKHgsIHkpO1xuICAgIGNvbnNvbGUubG9nKFwidG91Y2hzdGFydFwiKTtcbiAgfSk7XG4gIGZ4MT8uYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCAoZTogVG91Y2hFdmVudCkgPT4ge1xuICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoICE9IDEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdG91Y2ggPSBlLnRvdWNoZXNbMF07XG4gICAgY29uc3QgeyB4LCB5IH0gPSBub3JtYWxpemVkWFkodG91Y2guY2xpZW50WCwgdG91Y2guY2xpZW50WSk7XG4gICAgYWMuZngxKHgsIHkpO1xuICAgIGNvbnNvbGUubG9nKFwidG91Y2htb3ZlXCIpO1xuICB9KTtcbiAgZngxPy5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgKGU6IFRvdWNoRXZlbnQpID0+IHtcbiAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCAhPSAxKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGFjLmZ4MSgwLCAwKTtcbiAgICBjb25zb2xlLmxvZyhcInRvdWNoZW5kXCIpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRWxlbWVudChcbiAgdGFnOiBzdHJpbmcsXG4gIGNsczogc3RyaW5nLFxuICBpZDogc3RyaW5nLFxuICBwYXJlbnQ6IEhUTUxFbGVtZW50XG4pIHtcbiAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGNscyk7XG4gIGVsZW1lbnQuaWQgPSBpZDtcbiAgcGFyZW50LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICByZXR1cm4gZWxlbWVudDtcbn1cblxuZnVuY3Rpb24gc2hvd0JhbGxzKHNob3c6IGJvb2xlYW4pIHtcbiAgY29uc3QgYmFsbHM6IE5vZGVMaXN0T2Y8SFRNTEVsZW1lbnQ+ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5iYWxsXCIpO1xuICBiYWxscy5mb3JFYWNoKChiYWxsKSA9PiB7XG4gICAgYmFsbC5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/IFwiYmxvY2tcIiA6IFwibm9uZVwiO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0U3F1YXJlSWQoaWQ6IHN0cmluZyB8IG51bGwpOiBudW1iZXIge1xuICBpZiAoIWlkKSB7XG4gICAgcmV0dXJuIC0xO1xuICB9XG4gIGNvbnN0IHBhcnRzID0gaWQuc3BsaXQoXCJzcXVhcmUtXCIpO1xuICBpZiAocGFydHMubGVuZ3RoIDwgMikge1xuICAgIHJldHVybiAtMTtcbiAgfVxuICByZXR1cm4gcGFyc2VJbnQocGFydHNbMV0pO1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVkWFkoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgY29uc3Qgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgY29uc3QgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICByZXR1cm4geyB4OiB4IC8gd2lkdGgsIHk6IHkgLyBoZWlnaHQgfTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gaW5pdEF1ZGlvKCkge1xuICBpZiAoaXNJbml0aWF0ZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgYXdhaXQgYWMuaW5pdEF1ZGlvKFtcbiAgICBcInN0ZW1zLzQtb24tZmxvb3Iud2F2XCIsXG4gICAgXCJzdGVtcy9kbmItMTI0LndhdlwiLFxuICAgIFwic3RlbXMvZHJ1bXMud2F2XCIsXG4gICAgXCJzdGVtcy9oYXRzLndhdlwiLFxuICAgIFwic3RlbXMva2ljay1oYXQud2F2XCIsXG4gICAgXCJzdGVtcy90b21zLndhdlwiLFxuICAgIFwic3RlbXMvc21vb3RoLWNob3Jkcy53YXZcIixcbiAgICBcInN0ZW1zL2Jhc3Mud2F2XCIsXG4gICAgXCJzdGVtcy9ienp6LndhdlwiLFxuICAgIFwic3RlbXMvZ3VpdGFyLndhdlwiLFxuICAgIFwic3RlbXMvZG5iLTEyNC53YXZcIixcbiAgICBcInN0ZW1zL2RydW1zLndhdlwiLFxuICAgIFwic3RlbXMvaGF0cy53YXZcIixcbiAgICBcInN0ZW1zL2tlZXAtb24ud2F2XCIsXG4gICAgXCJzdGVtcy93aGF0LXUtZG9pbi10by1tZS53YXZcIixcbiAgICBcInN0ZW1zL2V4dGFjeS53YXZcIixcbiAgXSk7XG4gIGlzSW5pdGlhdGVkID0gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gc3Bpbm5lcihzaG93OiBib29sZWFuKSB7XG4gIGlmIChzaG93KSB7XG4gICAgY3JlYXRlRWxlbWVudChcImRpdlwiLCBcInNwaW5uZXJcIiwgXCJzcGlubmVyXCIsIGRvY3VtZW50LmJvZHkpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNwaW5uZXJcIik7XG4gICAgc3Bpbm5lcj8ucmVtb3ZlKCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlU3RhcnRCdXR0b24oKSB7XG4gIGNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGFydC1idXR0b25cIik7XG4gIGNvbnN0IGluZm8xID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpbmZvLTFcIik7XG4gIGNvbnN0IGluZm8yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpbmZvLTJcIik7XG4gIHN0YXJ0QnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgIHN0YXJ0QnV0dG9uLnJlbW92ZSgpO1xuICAgIGluZm8xPy5yZW1vdmUoKTtcbiAgICBpbmZvMj8ucmVtb3ZlKCk7XG4gICAgc3Bpbm5lcih0cnVlKTtcbiAgICBhd2FpdCBpbml0QXVkaW8oKTtcbiAgICBzcGlubmVyKGZhbHNlKTtcbiAgICBjcmVhdGVVSUVsZW1lbnRzKCk7XG4gICAgaW5pdFVJTG9naWMoKTtcbiAgICBpbml0RlhVSSgpO1xuICAgIGRyYXcoKTtcbiAgfSk7XG59XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcbiAgY3JlYXRlU3RhcnRCdXR0b24oKTtcbn0pO1xuXG5mdW5jdGlvbiBkcmF3KCkge1xuICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZHJhdyk7XG4gIGlmICghaXNJbml0aWF0ZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuU3F1YXJlczsgaSsrKSB7XG4gICAgY29uc3Qgc3F1YXJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHNxdWFyZS0ke2l9YCkgYXMgSFRNTEVsZW1lbnQ7XG4gICAgaWYgKHNxdWFyZSkge1xuICAgICAgc3F1YXJlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGFjLmdldEZyZXF1ZW5jeUNvbG9yKGkpO1xuICAgIH1cbiAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIEF1ZGlvQ29udHJvbGxlciB7XG4gIHByaXZhdGUgYXVkaW9Db250ZXh0OiBBdWRpb0NvbnRleHQ7XG4gIHByaXZhdGUgdHJhY2tzOiB7XG4gICAgc291cmNlTm9kZTogQXVkaW9CdWZmZXJTb3VyY2VOb2RlO1xuICAgIGdhaW5Ob2RlOiBHYWluTm9kZTtcbiAgICBhbmFseXNlck5vZGU6IEFuYWx5c2VyTm9kZTtcbiAgfVtdID0gW107XG4gIHByaXZhdGUgc2xvd0F2ZXJhZ2U6IG51bWJlciA9IDM5OyAvLyBvcmFuZ2VcbiAgcHJpdmF0ZSBmeDFhOiBCaXF1YWRGaWx0ZXJOb2RlIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZngxYjogRGVsYXlOb2RlIHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5hdWRpb0NvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KCk7XG4gIH1cblxuICBhc3luYyBpbml0QXVkaW8oZmlsZU5hbWVzOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmIChmaWxlTmFtZXMubGVuZ3RoICE9PSAxNikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRXhwZWN0ZWQgMTYgYXVkaW8gZmlsZXMuXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IGZpbGVQcm9taXNlcyA9IGZpbGVOYW1lcy5tYXAoKGZpbGVOYW1lKSA9PlxuICAgICAgdGhpcy5sb2FkQXVkaW9GaWxlKGZpbGVOYW1lKVxuICAgICk7XG5cbiAgICBjb25zdCBhdWRpb0J1ZmZlcnMgPSBhd2FpdCBQcm9taXNlLmFsbChmaWxlUHJvbWlzZXMpO1xuXG4gICAgYXVkaW9CdWZmZXJzLmZvckVhY2goKGJ1ZmZlcikgPT4ge1xuICAgICAgY29uc3Qgc291cmNlTm9kZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xuICAgICAgY29uc3QgZ2Fpbk5vZGUgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVHYWluKCk7XG5cbiAgICAgIHNvdXJjZU5vZGUuYnVmZmVyID0gYnVmZmVyO1xuICAgICAgZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IDA7IC8vIFN0YXJ0IG11dGVkXG4gICAgICBzb3VyY2VOb2RlLmNvbm5lY3QoZ2Fpbk5vZGUpO1xuXG4gICAgICAvLyBzZXQgdXAgYW4gYW5hbHlzZXIgc28gd2UgY2FuIGRvIGNvb2wgdmlzdWFsc1xuICAgICAgY29uc3QgYW5hbHlzZXJOb2RlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlQW5hbHlzZXIoKTtcbiAgICAgIGFuYWx5c2VyTm9kZS5mZnRTaXplID0gMjA0ODtcbiAgICAgIGdhaW5Ob2RlLmNvbm5lY3QoYW5hbHlzZXJOb2RlKTtcblxuICAgICAgLy8gc2V0IHVwIGZ4IG5vZGVzXG4gICAgICB0aGlzLmZ4MWEgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVCaXF1YWRGaWx0ZXIoKTtcbiAgICAgIHRoaXMuZngxYS50eXBlID0gXCJoaWdocGFzc1wiO1xuICAgICAgdGhpcy5meDFhLmZyZXF1ZW5jeS52YWx1ZSA9IDEwMDA7XG4gICAgICB0aGlzLmZ4MWEuZ2Fpbi52YWx1ZSA9IDA7XG4gICAgICBnYWluTm9kZS5jb25uZWN0KHRoaXMuZngxYSk7XG5cbiAgICAgIHRoaXMuZngxYiA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZURlbGF5KCk7XG4gICAgICB0aGlzLmZ4MWIuZGVsYXlUaW1lLnZhbHVlID0gMDsgLy8gcGFzcyB0aHJvdWdoXG4gICAgICB0aGlzLmZ4MWEuY29ubmVjdCh0aGlzLmZ4MWIpO1xuXG4gICAgICAvLyBmb3Igbm93IGp1c3QgYnlwYXNzIHRoZSBGWCBub2RlcyAtIG5vdCBpbXBsZW1lbnRlZCBwcm9wZXJseSB5ZXRcbiAgICAgIC8vICAgdGhpcy5meDFiLmNvbm5lY3QodGhpcy5hdWRpb0NvbnRleHQuZGVzdGluYXRpb24pO1xuICAgICAgZ2Fpbk5vZGUuY29ubmVjdCh0aGlzLmF1ZGlvQ29udGV4dC5kZXN0aW5hdGlvbik7XG5cbiAgICAgIHRoaXMudHJhY2tzLnB1c2goeyBzb3VyY2VOb2RlLCBnYWluTm9kZSwgYW5hbHlzZXJOb2RlIH0pO1xuXG4gICAgICBzb3VyY2VOb2RlLmxvb3AgPSB0cnVlO1xuICAgICAgc291cmNlTm9kZS5zdGFydCgwKTsgLy8gUGxheSBpbW1lZGlhdGVseSBpbiBzeW5jXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxvYWRBdWRpb0ZpbGUodXJsOiBzdHJpbmcpOiBQcm9taXNlPEF1ZGlvQnVmZmVyPiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwpO1xuICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTtcbiAgICByZXR1cm4gdGhpcy5hdWRpb0NvbnRleHQuZGVjb2RlQXVkaW9EYXRhKGFycmF5QnVmZmVyKTtcbiAgfVxuXG4gIGdldEZyZXF1ZW5jeUNvbG9yKHRyYWNrOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGNvbnN0IGdhaW5Ob2RlID0gdGhpcy50cmFja3NbdHJhY2tdLmdhaW5Ob2RlO1xuICAgIGlmIChnYWluTm9kZS5nYWluLnZhbHVlID09PSAwKSB7XG4gICAgICByZXR1cm4gYGhzbCgke3RoaXMuc2xvd0F2ZXJhZ2UgKyB0cmFja30sIDEwMCUsIDUwJSlgO1xuICAgIH1cbiAgICBjb25zdCBhbmFseXNlck5vZGUgPSB0aGlzLnRyYWNrc1t0cmFja10uYW5hbHlzZXJOb2RlO1xuICAgIGNvbnN0IGRhdGFBcnJheSA9IG5ldyBVaW50OEFycmF5KGFuYWx5c2VyTm9kZS5mcmVxdWVuY3lCaW5Db3VudCk7XG4gICAgYW5hbHlzZXJOb2RlLmdldEJ5dGVGcmVxdWVuY3lEYXRhKGRhdGFBcnJheSk7XG5cbiAgICAvLyBnZXQgdGhlIGhpZ2hlc3QgZnJlcXVlbmN5XG4gICAgY29uc3QgbWF4ID0gTWF0aC5tYXgoLi4uZGF0YUFycmF5KTtcbiAgICBjb25zdCBtYXhJbmRleCA9IGRhdGFBcnJheS5pbmRleE9mKG1heCk7XG4gICAgdGhpcy51cGRhdGVTbG93QXZlcmFnZShtYXhJbmRleCk7XG5cbiAgICBjb25zdCBodWUgPSB0aGlzLnNsb3dBdmVyYWdlICsgdHJhY2sgKyAoKG1heEluZGV4ICogMTApICUgMjQwKTtcbiAgICByZXR1cm4gYGhzbCgke2h1ZX0sIDEwMCUsIDUwJSlgO1xuICB9XG5cbiAgdXBkYXRlU2xvd0F2ZXJhZ2UodmFsdWU6IG51bWJlcikge1xuICAgIHRoaXMuc2xvd0F2ZXJhZ2UgPSB0aGlzLnNsb3dBdmVyYWdlICsgKCh2YWx1ZSAqIDAuMDAxKSAlIDI0MCk7XG4gIH1cblxuICBlbmFibGVUcmFjayh0cmFja051bWJlcjogbnVtYmVyLCBlbmFibGU6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBpZiAodHJhY2tOdW1iZXIgPT0gLTEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRyYWNrTnVtYmVyID49IHRoaXMudHJhY2tzLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUcmFjayAke3RyYWNrTnVtYmVyfSBkb2VzIG5vdCBleGlzdC5gKTtcbiAgICB9XG4gICAgY29uc29sZS5sb2coXCJFbmFibGluZyB0cmFja1wiLCB0cmFja051bWJlciwgZW5hYmxlKVxuICAgIHRoaXMudHJhY2tzW3RyYWNrTnVtYmVyXS5nYWluTm9kZS5nYWluLnZhbHVlID0gZW5hYmxlID8gMC41IDogMDtcbiAgfVxuXG4gIG11dGVBbGwoKTogdm9pZCB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRyYWNrcy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5lbmFibGVUcmFjayhpLCBmYWxzZSk7XG4gICAgfVxuICB9XG5cbiAgZngxKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgaWYgKHggIT0gMCAmJiB5ICE9IDApIHtcbiAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC4xKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCF0aGlzLmZ4MWEgfHwgIXRoaXMuZngxYikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhcImZ4MSBjYWxsZWQgd2l0aCB4OlwiLCB4LCBcInk6XCIsIHkpO1xuICAgIGNvbnNvbGUubG9nKFwiQXVkaW9Db250ZXh0IHN0YXRlOlwiLCB0aGlzLmF1ZGlvQ29udGV4dC5zdGF0ZSk7XG4gICAgY29uc29sZS5sb2coXCJDdXJyZW50IHRpbWU6XCIsIHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lKTtcblxuICAgIGNvbnNvbGUubG9nKFwiQXBwbHlpbmcgZ2FpbjpcIiwgeCAqIDI1LCBcInRvIGZ4MWFcIik7XG4gICAgY29uc3QgZ2FpbiA9IE1hdGguZmxvb3IoeCAqIDEwKTtcbiAgICB0aGlzLmZ4MWEuZ2Fpbi5zZXRWYWx1ZUF0VGltZShnYWluLCB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSk7XG4gICAgdGhpcy5meDFiLmRlbGF5VGltZS5zZXRWYWx1ZUF0VGltZSh5LCB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSk7XG5cbiAgICBjb25zb2xlLmxvZyh0aGlzLmZ4MWEsIHRoaXMuZngxYik7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJhYyIsImF1ZGlvQ29udGV4dCIsInRyYWNrcyIsInNsb3dBdmVyYWdlIiwiZngxYSIsImZ4MWIiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJBdWRpb0NvbnRleHQiLCJpbml0QXVkaW8iLCJmaWxlTmFtZXMiLCJsZW5ndGgiLCJFcnJvciIsImZpbGVQcm9taXNlcyIsIm1hcCIsImZpbGVOYW1lIiwibG9hZEF1ZGlvRmlsZSIsIlByb21pc2UiLCJhbGwiLCJmb3JFYWNoIiwiYnVmZmVyIiwic291cmNlTm9kZSIsImNyZWF0ZUJ1ZmZlclNvdXJjZSIsImdhaW5Ob2RlIiwiY3JlYXRlR2FpbiIsImdhaW4iLCJ2YWx1ZSIsImNvbm5lY3QiLCJhbmFseXNlck5vZGUiLCJjcmVhdGVBbmFseXNlciIsImZmdFNpemUiLCJjcmVhdGVCaXF1YWRGaWx0ZXIiLCJ0eXBlIiwiZnJlcXVlbmN5IiwiY3JlYXRlRGVsYXkiLCJkZWxheVRpbWUiLCJkZXN0aW5hdGlvbiIsInB1c2giLCJsb29wIiwic3RhcnQiLCJ1cmwiLCJyZXNwb25zZSIsImZldGNoIiwiYXJyYXlCdWZmZXIiLCJkZWNvZGVBdWRpb0RhdGEiLCJnZXRGcmVxdWVuY3lDb2xvciIsInRyYWNrIiwiZGF0YUFycmF5IiwiVWludDhBcnJheSIsImZyZXF1ZW5jeUJpbkNvdW50IiwiZ2V0Qnl0ZUZyZXF1ZW5jeURhdGEiLCJtYXgiLCJNYXRoIiwibWF4SW5kZXgiLCJpbmRleE9mIiwidXBkYXRlU2xvd0F2ZXJhZ2UiLCJlbmFibGVUcmFjayIsInRyYWNrTnVtYmVyIiwiZW5hYmxlIiwiY29uc29sZSIsImxvZyIsIm11dGVBbGwiLCJpIiwiZngxIiwieCIsInkiLCJyYW5kb20iLCJzdGF0ZSIsImN1cnJlbnRUaW1lIiwiZmxvb3IiLCJzZXRWYWx1ZUF0VGltZSIsIm5TcXVhcmVzIiwiaXNJbml0aWF0ZWQiLCJnZXRQb3NpdGlvbkZyb21FdmVudCIsImUiLCJUb3VjaEV2ZW50IiwidG91Y2hlcyIsImNoYW5nZWRUb3VjaGVzIiwiY2xpZW50WCIsImNsaWVudFkiLCJNb3VzZUV2ZW50IiwiY3JlYXRlRWxlbWVudCIsInRhZyIsImNscyIsImlkIiwicGFyZW50IiwiZWxlbWVudCIsImRvY3VtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJzaG93QmFsbHMiLCJzaG93IiwicXVlcnlTZWxlY3RvckFsbCIsImJhbGwiLCJzdHlsZSIsImRpc3BsYXkiLCJnZXRTcXVhcmVJZCIsInBhcnRzIiwic3BsaXQiLCJwYXJzZUludCIsInNwaW5uZXIiLCJib2R5IiwiZ2V0RWxlbWVudEJ5SWQiLCJyZW1vdmUiLCJjcmVhdGVTdGFydEJ1dHRvbiIsInN0YXJ0QnV0dG9uIiwiaW5mbzEiLCJpbmZvMiIsImFkZEV2ZW50TGlzdGVuZXIiLCJhc3luYyIsIm1hdHJpeCIsImJhbGxIb21lIiwiZHJhZ2dhYmxlIiwiaW5uZXJUZXh0IiwiY3JlYXRlVUlFbGVtZW50cyIsInN0YXJ0RHJhZyIsInByZXZlbnREZWZhdWx0Iiwib3JpZ2luU3F1YXJlIiwicGFyZW50RWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImRvRHJhZyIsImdldEF0dHJpYnV0ZSIsInBvc2l0aW9uIiwibGVmdCIsInRvcCIsImVuZERyYWciLCJvcmlnaW5TcXVhcmVJZCIsInRhcmdldEVsZW1lbnQiLCJlbGVtZW50RnJvbVBvaW50IiwidGFyZ2V0IiwiZHJvcEJhbGwiLCJkcmF3IiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwic3F1YXJlIiwiYmFja2dyb3VuZENvbG9yIl0sInNvdXJjZVJvb3QiOiIifQ==