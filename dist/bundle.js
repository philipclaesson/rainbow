(()=>{"use strict";const e=new class{audioContext;tracks=[];slowAverage=39;constructor(){this.audioContext=new AudioContext}async initAudio(e){if(16!==e.length)throw new Error("Expected 16 audio files.");const t=e.map((e=>this.loadAudioFile(e)));(await Promise.all(t)).forEach((e=>{const t=this.audioContext.createBufferSource(),n=this.audioContext.createGain();t.buffer=e,n.gain.value=0;const o=this.audioContext.createAnalyser();o.fftSize=2048,n.connect(o),t.connect(n),n.connect(this.audioContext.destination),this.tracks.push({sourceNode:t,gainNode:n,analyserNode:o}),t.loop=!0,t.start(0)}))}async loadAudioFile(e){const t=await fetch(e),n=await t.arrayBuffer();return this.audioContext.decodeAudioData(n)}getNoiseColor(e){const t=this.tracks[e].analyserNode,n=new Uint8Array(t.frequencyBinCount);t.getByteFrequencyData(n);const o=n.reduce(((e,t)=>e+t),0)/n.length;return`hsl(${Math.min(100+5*o,240)}, 100%, 50%)`}getFrequencyColor(e){if(0===this.tracks[e].gainNode.gain.value)return`hsl(${this.slowAverage+e}, 100%, 50%)`;const t=this.tracks[e].analyserNode,n=new Uint8Array(t.frequencyBinCount);t.getByteFrequencyData(n);const o=Math.max(...n),a=n.indexOf(o);return this.updateSlowAverage(a),`hsl(${this.slowAverage+e+10*a%240}, 100%, 50%)`}updateSlowAverage(e){this.slowAverage=this.slowAverage+.001*e%240}unMuteTrack(e){if(-1!=e){if(!this.tracks[e])throw new Error(`Track ${e} does not exist.`);this.tracks[e].gainNode.gain.value=.5}}muteTrack(e){if(-1!=e){if(!this.tracks[e])throw new Error(`Track ${e} does not exist.`);this.tracks[e].gainNode.gain.value=0}}muteAll(){for(let e=0;e<this.tracks.length;e++)this.muteTrack(e)}},t=16;var n=!1,o=!1,a=null;function s(e){document.querySelectorAll(".ball").forEach((t=>{t.style.display=e?"block":"none"}))}function r(e){if(!e)return-1;const t=e.split("square-");return t.length<2?-1:parseInt(t[1])}function i(e){if(e){const e=document.createElement("div");e.classList.add("spinner"),e.id="spinner",document.body.appendChild(e)}else{const e=document.getElementById("spinner");e?.remove()}}function d(){if(requestAnimationFrame(d),n)for(let n=0;n<t;n++){const t=document.getElementById(`square-${n}`);t&&(t.style.backgroundColor=e.getFrequencyColor(n))}}document.addEventListener("DOMContentLoaded",(()=>{!function(){const c=document.getElementById("start-button"),l=document.getElementById("info");c?.addEventListener("click",(async()=>{c.remove(),l?.remove(),i(!0),await async function(){n||(await e.initAudio(["stems/4-on-floor.wav","stems/bass.wav","stems/dnb-124.wav","stems/drums.wav","stems/hats.wav","stems/kick-hat.wav","stems/smooth-chords.wav","stems/toms.wav","stems/4-on-floor.wav","stems/bass.wav","stems/dnb-124.wav","stems/drums.wav","stems/hats.wav","stems/kick-hat.wav","stems/smooth-chords.wav","stems/toms.wav"]),n=!0)}(),i(!1),function(){const e=document.createElement("div");e.classList.add("matrix"),e.id="matrix",document.body.appendChild(e);for(let n=0;n<t;n++){const t=document.createElement("div");t.classList.add("square"),t.id=`square-${n}`,e.appendChild(t)}(a=document.createElement("div")).classList.add("ballhome"),a.id="ballhome",document.body.appendChild(a);for(let e=0;e<3;e++){const t=document.createElement("div");t.classList.add("ball"),t.id=`ball-${e}`,t.draggable=!0,t.innerText="ðŸŒˆ",a.appendChild(t)}}(),function(){const t=document.querySelectorAll(".ball"),n=document.querySelectorAll(".square");let i=null,d=null;const c=t=>{i&&(console.log("Dropped:",i.id,t.id),e.unMuteTrack(r(t.id)),t.appendChild(i),d=null,i.style.display="block",i=null)};if(t.forEach((t=>{t.addEventListener("dragstart",(n=>{i=t,d=t.parentElement,n.dataTransfer?.setData("text/plain",t.id),console.log("[Dragstart]: Lifted",t.id,"from",d.id),e.muteTrack(r(d.id))})),t.addEventListener("touchstart",(n=>{o=!0,i=t,d=t.parentElement,console.log("[Touchstart] Lifted",t.id,"from",d.id),e.muteTrack(r(d.id))})),t.addEventListener("touchmove",(e=>{if(console.log("[Touchmove] Dragging",t.id,e.touches.length),e.preventDefault(),o=!0,1===e.touches.length){const n=e.touches[0];t.style.left=n.clientX-25+"px",t.style.top=n.clientY-25+"px"}})),t.addEventListener("touchend",(e=>{if(console.log("[Touchend] Dropped",t.id),!i)return;s(!1);const n=e.changedTouches[0],o=document.elementFromPoint(n.clientX,n.clientY);s(!0),c(o)}))})),n.forEach((e=>{e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(t=>{t.preventDefault(),c(e)}))})),!a)throw new Error("Ball home not found");a.addEventListener("dragover",(e=>{e.preventDefault()})),a.addEventListener("drop",(e=>{if(e.preventDefault(),!a)throw new Error("Ball home not found");c(a)})),document.addEventListener("dragover",(e=>{o||e.preventDefault()})),document.addEventListener("drop",(e=>{if(!o){const e=document.getElementById("ballhome");c(e)}}))}(),d()}))}()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU0sSUFBSXJELE1BQU0sdUJBRWxCcUQsRUFBU3lCLGlCQUFpQixZQUFhZ0IsSUFDckNBLEVBQUVLLGdCQUFnQixJQUdwQjlDLEVBQVN5QixpQkFBaUIsUUFBU2dCLElBRWpDLEdBREFBLEVBQUVLLGtCQUNHOUMsRUFDSCxNQUFNLElBQUlyRCxNQUFNLHVCQUVsQjBGLEVBQVNyQyxFQUFTLElBR3BCRyxTQUFTc0IsaUJBQWlCLFlBQWFnQixJQUNoQzFDLEdBQ0gwQyxFQUFFSyxnQixJQUdOM0MsU0FBU3NCLGlCQUFpQixRQUFTZ0IsSUFDakMsSUFBSzFDLEVBQWEsQ0FDaEIsTUFBTUMsRUFBV0csU0FBU2dCLGVBQWUsWUFDekNrQixFQUFTckMsRSxJQUdmLENBb0VJdUQsR0FDQWxDLEdBQU0sR0FFVixDQUdFbUMsRUFBbUIsRyIsInNvdXJjZXMiOlsid2VicGFjazovL3NxdWFyZXMvLi9zcmMvbWFpbi50cyIsIndlYnBhY2s6Ly9zcXVhcmVzLy4vc3JjL2F1ZGlvLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEF1ZGlvQ29udHJvbGxlciB9IGZyb20gXCIuL2F1ZGlvXCI7XG5cbmNvbnN0IGFjID0gbmV3IEF1ZGlvQ29udHJvbGxlcigpO1xuY29uc3QgblNxdWFyZXMgPSAxNjtcbmNvbnN0IG5CYWxscyA9IDM7XG52YXIgaXNQbGF5aW5nID0gZmFsc2U7XG52YXIgaXNJbml0aWF0ZWQgPSBmYWxzZTtcbnZhciBtb2JpbGVVc2FnZSA9IGZhbHNlO1xudmFyIGJhbGxIb21lOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuXG5mdW5jdGlvbiBjcmVhdGVVSSgpIHtcbiAgY29uc3QgbWF0cml4ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgbWF0cml4LmNsYXNzTGlzdC5hZGQoXCJtYXRyaXhcIik7XG4gIG1hdHJpeC5pZCA9IFwibWF0cml4XCI7XG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobWF0cml4KTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuU3F1YXJlczsgaSsrKSB7XG4gICAgY29uc3Qgc3F1YXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcInNxdWFyZVwiKTtcbiAgICBzcXVhcmUuaWQgPSBgc3F1YXJlLSR7aX1gO1xuICAgIG1hdHJpeC5hcHBlbmRDaGlsZChzcXVhcmUpO1xuICB9XG4gIGJhbGxIb21lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgYmFsbEhvbWUuY2xhc3NMaXN0LmFkZChcImJhbGxob21lXCIpO1xuICBiYWxsSG9tZS5pZCA9IFwiYmFsbGhvbWVcIjtcbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChiYWxsSG9tZSk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuQmFsbHM7IGkrKykge1xuICAgIGNvbnN0IGJhbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGJhbGwuY2xhc3NMaXN0LmFkZChcImJhbGxcIik7XG4gICAgYmFsbC5pZCA9IGBiYWxsLSR7aX1gO1xuICAgIGJhbGwuZHJhZ2dhYmxlID0gdHJ1ZTtcbiAgICBiYWxsLmlubmVyVGV4dCA9IGDwn4yIYDtcbiAgICBiYWxsSG9tZS5hcHBlbmRDaGlsZChiYWxsKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpbml0VUkoKSB7XG4gIGNvbnN0IGJhbGxzOiBOb2RlTGlzdE9mPEhUTUxFbGVtZW50PiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYmFsbFwiKTtcbiAgY29uc3Qgc3F1YXJlczogTm9kZUxpc3RPZjxIVE1MRWxlbWVudD4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNxdWFyZVwiKTtcbiAgbGV0IGFjdGl2ZUJhbGw6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gIGxldCBvcmlnaW5TcXVhcmU6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3QgZHJvcEJhbGwgPSAodGFyZ2V0OiBIVE1MRWxlbWVudCkgPT4ge1xuICAgIGlmIChhY3RpdmVCYWxsKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkRyb3BwZWQ6XCIsIGFjdGl2ZUJhbGwuaWQsIHRhcmdldC5pZCk7XG4gICAgICBhYy51bk11dGVUcmFjayhnZXRTcXVhcmVJZCh0YXJnZXQuaWQpKTtcbiAgICAgIHRhcmdldC5hcHBlbmRDaGlsZChhY3RpdmVCYWxsKTtcbiAgICAgIG9yaWdpblNxdWFyZSA9IG51bGw7XG4gICAgICBhY3RpdmVCYWxsLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7IC8vIE1ha2Ugc3VyZSB0byBkaXNwbGF5IHRoZSBiYWxsIGFnYWluXG4gICAgICBhY3RpdmVCYWxsID0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgYmFsbHMuZm9yRWFjaCgoYmFsbCkgPT4ge1xuICAgIGJhbGwuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCAoZTogRHJhZ0V2ZW50KSA9PiB7XG4gICAgICBhY3RpdmVCYWxsID0gYmFsbDtcbiAgICAgIG9yaWdpblNxdWFyZSA9IGJhbGwucGFyZW50RWxlbWVudCBhcyBIVE1MRWxlbWVudDtcbiAgICAgIGUuZGF0YVRyYW5zZmVyPy5zZXREYXRhKFwidGV4dC9wbGFpblwiLCBiYWxsLmlkKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiW0RyYWdzdGFydF06IExpZnRlZFwiLCBiYWxsLmlkLCBcImZyb21cIiwgb3JpZ2luU3F1YXJlLmlkKTtcbiAgICAgIGFjLm11dGVUcmFjayhnZXRTcXVhcmVJZChvcmlnaW5TcXVhcmUuaWQpKTtcbiAgICB9KTtcblxuICAgIGJhbGwuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgKGU6IFRvdWNoRXZlbnQpID0+IHtcbiAgICAgIG1vYmlsZVVzYWdlID0gdHJ1ZTtcbiAgICAgIGFjdGl2ZUJhbGwgPSBiYWxsO1xuICAgICAgb3JpZ2luU3F1YXJlID0gYmFsbC5wYXJlbnRFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xuICAgICAgY29uc29sZS5sb2coXCJbVG91Y2hzdGFydF0gTGlmdGVkXCIsIGJhbGwuaWQsIFwiZnJvbVwiLCBvcmlnaW5TcXVhcmUuaWQpO1xuICAgICAgYWMubXV0ZVRyYWNrKGdldFNxdWFyZUlkKG9yaWdpblNxdWFyZS5pZCkpO1xuICAgIH0pO1xuXG4gICAgYmFsbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIChlOiBUb3VjaEV2ZW50KSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIltUb3VjaG1vdmVdIERyYWdnaW5nXCIsIGJhbGwuaWQsIGUudG91Y2hlcy5sZW5ndGgpO1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgbW9iaWxlVXNhZ2UgPSB0cnVlO1xuICAgICAgaWYgKGUudG91Y2hlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgY29uc3QgdG91Y2ggPSBlLnRvdWNoZXNbMF07XG4gICAgICAgIGJhbGwuc3R5bGUubGVmdCA9IGAke3RvdWNoLmNsaWVudFggLSAyNX1weGA7IC8vIEFkanVzdCBmb3IgY2VudGVyIG9mIHRoZSBiYWxsXG4gICAgICAgIGJhbGwuc3R5bGUudG9wID0gYCR7dG91Y2guY2xpZW50WSAtIDI1fXB4YDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGJhbGwuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIChlOiBUb3VjaEV2ZW50KSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIltUb3VjaGVuZF0gRHJvcHBlZFwiLCBiYWxsLmlkKTtcbiAgICAgIGlmICghYWN0aXZlQmFsbCkgcmV0dXJuO1xuICAgICAgc2hvd0JhbGxzKGZhbHNlKTtcbiAgICAgIGNvbnN0IHRvdWNoID0gZS5jaGFuZ2VkVG91Y2hlc1swXTtcbiAgICAgIGNvbnN0IHRhcmdldEVsZW1lbnQgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KFxuICAgICAgICB0b3VjaC5jbGllbnRYLFxuICAgICAgICB0b3VjaC5jbGllbnRZXG4gICAgICApIGFzIEhUTUxFbGVtZW50O1xuICAgICAgc2hvd0JhbGxzKHRydWUpO1xuICAgICAgZHJvcEJhbGwodGFyZ2V0RWxlbWVudCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIHNxdWFyZXMuZm9yRWFjaCgoc3F1YXJlKSA9PiB7XG4gICAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCAoZTogRHJhZ0V2ZW50KSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG5cbiAgICBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgKGU6IERyYWdFdmVudCkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZHJvcEJhbGwoc3F1YXJlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgaWYgKCFiYWxsSG9tZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkJhbGwgaG9tZSBub3QgZm91bmRcIik7XG4gIH1cbiAgYmFsbEhvbWUuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIChlOiBEcmFnRXZlbnQpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIH0pO1xuXG4gIGJhbGxIb21lLmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIChlOiBEcmFnRXZlbnQpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKCFiYWxsSG9tZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQmFsbCBob21lIG5vdCBmb3VuZFwiKTtcbiAgICB9XG4gICAgZHJvcEJhbGwoYmFsbEhvbWUpO1xuICB9KTtcblxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ292ZXJcIiwgKGUpID0+IHtcbiAgICBpZiAoIW1vYmlsZVVzYWdlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7IC8vIFRoaXMgYWxsb3dzIHRoZSBkcm9wIHRvIGJlIGFjY2VwdGVkLlxuICAgIH1cbiAgfSk7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIChlKSA9PiB7XG4gICAgaWYgKCFtb2JpbGVVc2FnZSkge1xuICAgICAgY29uc3QgYmFsbEhvbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhbGxob21lXCIpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgZHJvcEJhbGwoYmFsbEhvbWUpO1xuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHNob3dCYWxscyhzaG93OiBib29sZWFuKSB7XG4gIGNvbnN0IGJhbGxzOiBOb2RlTGlzdE9mPEhUTUxFbGVtZW50PiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYmFsbFwiKTtcbiAgYmFsbHMuZm9yRWFjaCgoYmFsbCkgPT4ge1xuICAgIGJhbGwuc3R5bGUuZGlzcGxheSA9IHNob3cgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldFNxdWFyZUlkKGlkOiBzdHJpbmcgfCBudWxsKTogbnVtYmVyIHtcbiAgaWYgKCFpZCkge1xuICAgIHJldHVybiAtMTtcbiAgfVxuICBjb25zdCBwYXJ0cyA9IGlkLnNwbGl0KFwic3F1YXJlLVwiKTtcbiAgaWYgKHBhcnRzLmxlbmd0aCA8IDIpIHtcbiAgICByZXR1cm4gLTE7XG4gIH1cbiAgcmV0dXJuIHBhcnNlSW50KHBhcnRzWzFdKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gaW5pdEF1ZGlvKCkge1xuICBpZiAoaXNJbml0aWF0ZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgYXdhaXQgYWMuaW5pdEF1ZGlvKFtcbiAgICBcInN0ZW1zLzQtb24tZmxvb3Iud2F2XCIsXG4gICAgXCJzdGVtcy9iYXNzLndhdlwiLFxuICAgIFwic3RlbXMvZG5iLTEyNC53YXZcIixcbiAgICBcInN0ZW1zL2RydW1zLndhdlwiLFxuICAgIFwic3RlbXMvaGF0cy53YXZcIixcbiAgICBcInN0ZW1zL2tpY2staGF0LndhdlwiLFxuICAgIFwic3RlbXMvc21vb3RoLWNob3Jkcy53YXZcIixcbiAgICBcInN0ZW1zL3RvbXMud2F2XCIsXG4gICAgXCJzdGVtcy80LW9uLWZsb29yLndhdlwiLFxuICAgIFwic3RlbXMvYmFzcy53YXZcIixcbiAgICBcInN0ZW1zL2RuYi0xMjQud2F2XCIsXG4gICAgXCJzdGVtcy9kcnVtcy53YXZcIixcbiAgICBcInN0ZW1zL2hhdHMud2F2XCIsXG4gICAgXCJzdGVtcy9raWNrLWhhdC53YXZcIixcbiAgICBcInN0ZW1zL3Ntb290aC1jaG9yZHMud2F2XCIsXG4gICAgXCJzdGVtcy90b21zLndhdlwiLFxuICBdKTtcbiAgaXNJbml0aWF0ZWQgPSB0cnVlO1xufVxuXG5mdW5jdGlvbiBzcGlubmVyKHNob3c6IGJvb2xlYW4pIHtcbiAgaWYgKHNob3cpIHtcbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIHNwaW5uZXIuY2xhc3NMaXN0LmFkZChcInNwaW5uZXJcIik7XG4gICAgc3Bpbm5lci5pZCA9IFwic3Bpbm5lclwiO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3Bpbm5lclwiKTtcbiAgICBzcGlubmVyPy5yZW1vdmUoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVTdGFydEJ1dHRvbigpIHtcbiAgY29uc3Qgc3RhcnRCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXJ0LWJ1dHRvblwiKTtcbiAgY29uc3QgaW5mbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaW5mb1wiKTtcbiAgc3RhcnRCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgc3RhcnRCdXR0b24ucmVtb3ZlKCk7XG4gICAgaW5mbz8ucmVtb3ZlKCk7XG4gICAgc3Bpbm5lcih0cnVlKTtcbiAgICBhd2FpdCBpbml0QXVkaW8oKTtcbiAgICBzcGlubmVyKGZhbHNlKTtcbiAgICBjcmVhdGVVSSgpO1xuICAgIGluaXRVSSgpO1xuICAgIGRyYXcoKTtcbiAgfSk7XG59XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcbiAgY3JlYXRlU3RhcnRCdXR0b24oKTtcbn0pO1xuXG5mdW5jdGlvbiBkcmF3KCkge1xuICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZHJhdyk7XG4gIGlmICghaXNJbml0aWF0ZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuU3F1YXJlczsgaSsrKSB7XG4gICAgY29uc3Qgc3F1YXJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHNxdWFyZS0ke2l9YCkgYXMgSFRNTEVsZW1lbnQ7XG4gICAgaWYgKHNxdWFyZSkge1xuICAgICAgc3F1YXJlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGFjLmdldEZyZXF1ZW5jeUNvbG9yKGkpO1xuICAgIH1cbiAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIEF1ZGlvQ29udHJvbGxlciB7XG4gIHByaXZhdGUgYXVkaW9Db250ZXh0OiBBdWRpb0NvbnRleHQ7XG4gIHByaXZhdGUgdHJhY2tzOiB7XG4gICAgc291cmNlTm9kZTogQXVkaW9CdWZmZXJTb3VyY2VOb2RlO1xuICAgIGdhaW5Ob2RlOiBHYWluTm9kZTtcbiAgICBhbmFseXNlck5vZGU6IEFuYWx5c2VyTm9kZTtcbiAgfVtdID0gW107XG4gIHByaXZhdGUgc2xvd0F2ZXJhZ2U6IG51bWJlciA9IDM5OyAvLyBvcmFuZ2VcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmF1ZGlvQ29udGV4dCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcbiAgfVxuXG4gIGFzeW5jIGluaXRBdWRpbyhmaWxlTmFtZXM6IHN0cmluZ1tdKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKGZpbGVOYW1lcy5sZW5ndGggIT09IDE2KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFeHBlY3RlZCAxNiBhdWRpbyBmaWxlcy5cIik7XG4gICAgfVxuXG4gICAgY29uc3QgZmlsZVByb21pc2VzID0gZmlsZU5hbWVzLm1hcCgoZmlsZU5hbWUpID0+XG4gICAgICB0aGlzLmxvYWRBdWRpb0ZpbGUoZmlsZU5hbWUpXG4gICAgKTtcblxuICAgIGNvbnN0IGF1ZGlvQnVmZmVycyA9IGF3YWl0IFByb21pc2UuYWxsKGZpbGVQcm9taXNlcyk7XG5cbiAgICBhdWRpb0J1ZmZlcnMuZm9yRWFjaCgoYnVmZmVyKSA9PiB7XG4gICAgICBjb25zdCBzb3VyY2VOb2RlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gICAgICBjb25zdCBnYWluTm9kZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUdhaW4oKTtcblxuICAgICAgc291cmNlTm9kZS5idWZmZXIgPSBidWZmZXI7XG4gICAgICBnYWluTm9kZS5nYWluLnZhbHVlID0gMDsgLy8gU3RhcnQgbXV0ZWRcblxuICAgICAgLy8gc2V0IHVwIGFuIGFuYWx5c2VyIHNvIHdlIGNhbiBkbyBjb29sIHZpc3VhbHNcbiAgICAgIGNvbnN0IGFuYWx5c2VyTm9kZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUFuYWx5c2VyKCk7XG4gICAgICBhbmFseXNlck5vZGUuZmZ0U2l6ZSA9IDIwNDg7XG4gICAgICBnYWluTm9kZS5jb25uZWN0KGFuYWx5c2VyTm9kZSk7XG5cbiAgICAgIHNvdXJjZU5vZGUuY29ubmVjdChnYWluTm9kZSk7XG4gICAgICBnYWluTm9kZS5jb25uZWN0KHRoaXMuYXVkaW9Db250ZXh0LmRlc3RpbmF0aW9uKTtcblxuICAgICAgdGhpcy50cmFja3MucHVzaCh7IHNvdXJjZU5vZGUsIGdhaW5Ob2RlLCBhbmFseXNlck5vZGUgfSk7XG5cbiAgICAgIHNvdXJjZU5vZGUubG9vcCA9IHRydWU7XG4gICAgICBzb3VyY2VOb2RlLnN0YXJ0KDApOyAvLyBQbGF5IGltbWVkaWF0ZWx5IGluIHN5bmNcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9hZEF1ZGlvRmlsZSh1cmw6IHN0cmluZyk6IFByb21pc2U8QXVkaW9CdWZmZXI+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpO1xuICAgIHJldHVybiB0aGlzLmF1ZGlvQ29udGV4dC5kZWNvZGVBdWRpb0RhdGEoYXJyYXlCdWZmZXIpO1xuICB9XG5cbiAgZ2V0Tm9pc2VDb2xvcih0cmFjazogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBjb25zdCBhbmFseXNlck5vZGUgPSB0aGlzLnRyYWNrc1t0cmFja10uYW5hbHlzZXJOb2RlO1xuICAgIGNvbnN0IGRhdGFBcnJheSA9IG5ldyBVaW50OEFycmF5KGFuYWx5c2VyTm9kZS5mcmVxdWVuY3lCaW5Db3VudCk7XG4gICAgYW5hbHlzZXJOb2RlLmdldEJ5dGVGcmVxdWVuY3lEYXRhKGRhdGFBcnJheSk7XG5cbiAgICBjb25zdCBhdmVyYWdlID1cbiAgICAgIGRhdGFBcnJheS5yZWR1Y2UoKGFjYywgdmFsKSA9PiBhY2MgKyB2YWwsIDApIC8gZGF0YUFycmF5Lmxlbmd0aDtcbiAgICBjb25zdCBodWUgPSBNYXRoLm1pbigxMDAgKyBhdmVyYWdlICogNSwgMjQwKTtcbiAgICByZXR1cm4gYGhzbCgke2h1ZX0sIDEwMCUsIDUwJSlgO1xuICB9XG5cbiAgZ2V0RnJlcXVlbmN5Q29sb3IodHJhY2s6IG51bWJlcik6IHN0cmluZyB7XG4gICAgY29uc3QgZ2Fpbk5vZGUgPSB0aGlzLnRyYWNrc1t0cmFja10uZ2Fpbk5vZGU7XG4gICAgaWYgKGdhaW5Ob2RlLmdhaW4udmFsdWUgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGBoc2woJHt0aGlzLnNsb3dBdmVyYWdlICsgdHJhY2t9LCAxMDAlLCA1MCUpYDtcbiAgICB9XG4gICAgY29uc3QgYW5hbHlzZXJOb2RlID0gdGhpcy50cmFja3NbdHJhY2tdLmFuYWx5c2VyTm9kZTtcbiAgICBjb25zdCBkYXRhQXJyYXkgPSBuZXcgVWludDhBcnJheShhbmFseXNlck5vZGUuZnJlcXVlbmN5QmluQ291bnQpO1xuICAgIGFuYWx5c2VyTm9kZS5nZXRCeXRlRnJlcXVlbmN5RGF0YShkYXRhQXJyYXkpO1xuXG4gICAgLy8gZ2V0IHRoZSBoaWdoZXN0IGZyZXF1ZW5jeVxuICAgIGNvbnN0IG1heCA9IE1hdGgubWF4KC4uLmRhdGFBcnJheSk7XG4gICAgY29uc3QgbWF4SW5kZXggPSBkYXRhQXJyYXkuaW5kZXhPZihtYXgpO1xuICAgIHRoaXMudXBkYXRlU2xvd0F2ZXJhZ2UobWF4SW5kZXgpO1xuXG4gICAgY29uc3QgaHVlID0gdGhpcy5zbG93QXZlcmFnZSArIHRyYWNrICsgKChtYXhJbmRleCAqIDEwKSAlIDI0MCk7XG4gICAgcmV0dXJuIGBoc2woJHtodWV9LCAxMDAlLCA1MCUpYDtcbiAgfVxuXG4gIHVwZGF0ZVNsb3dBdmVyYWdlKHZhbHVlOiBudW1iZXIpIHtcbiAgICB0aGlzLnNsb3dBdmVyYWdlID0gdGhpcy5zbG93QXZlcmFnZSArIHZhbHVlICogMC4wMDEgJSAyNDA7XG4gIH1cblxuICB1bk11dGVUcmFjayh0cmFja051bWJlcjogbnVtYmVyKTogdm9pZCB7XG4gICAgaWYgKHRyYWNrTnVtYmVyID09IC0xKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLnRyYWNrc1t0cmFja051bWJlcl0pIHtcbiAgICAgIHRoaXMudHJhY2tzW3RyYWNrTnVtYmVyXS5nYWluTm9kZS5nYWluLnZhbHVlID0gMC41O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRyYWNrICR7dHJhY2tOdW1iZXJ9IGRvZXMgbm90IGV4aXN0LmApO1xuICAgIH1cbiAgfVxuXG4gIG11dGVUcmFjayh0cmFja051bWJlcjogbnVtYmVyKTogdm9pZCB7XG4gICAgaWYgKHRyYWNrTnVtYmVyID09IC0xKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLnRyYWNrc1t0cmFja051bWJlcl0pIHtcbiAgICAgIHRoaXMudHJhY2tzW3RyYWNrTnVtYmVyXS5nYWluTm9kZS5nYWluLnZhbHVlID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUcmFjayAke3RyYWNrTnVtYmVyfSBkb2VzIG5vdCBleGlzdC5gKTtcbiAgICB9XG4gIH1cblxuICBtdXRlQWxsKCk6IHZvaWQge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50cmFja3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMubXV0ZVRyYWNrKGkpO1xuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbImFjIiwiYXVkaW9Db250ZXh0IiwidHJhY2tzIiwic2xvd0F2ZXJhZ2UiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJBdWRpb0NvbnRleHQiLCJpbml0QXVkaW8iLCJmaWxlTmFtZXMiLCJsZW5ndGgiLCJFcnJvciIsImZpbGVQcm9taXNlcyIsIm1hcCIsImZpbGVOYW1lIiwibG9hZEF1ZGlvRmlsZSIsIlByb21pc2UiLCJhbGwiLCJmb3JFYWNoIiwiYnVmZmVyIiwic291cmNlTm9kZSIsImNyZWF0ZUJ1ZmZlclNvdXJjZSIsImdhaW5Ob2RlIiwiY3JlYXRlR2FpbiIsImdhaW4iLCJ2YWx1ZSIsImFuYWx5c2VyTm9kZSIsImNyZWF0ZUFuYWx5c2VyIiwiZmZ0U2l6ZSIsImNvbm5lY3QiLCJkZXN0aW5hdGlvbiIsInB1c2giLCJsb29wIiwic3RhcnQiLCJ1cmwiLCJyZXNwb25zZSIsImZldGNoIiwiYXJyYXlCdWZmZXIiLCJkZWNvZGVBdWRpb0RhdGEiLCJnZXROb2lzZUNvbG9yIiwidHJhY2siLCJkYXRhQXJyYXkiLCJVaW50OEFycmF5IiwiZnJlcXVlbmN5QmluQ291bnQiLCJnZXRCeXRlRnJlcXVlbmN5RGF0YSIsImF2ZXJhZ2UiLCJyZWR1Y2UiLCJhY2MiLCJ2YWwiLCJNYXRoIiwibWluIiwiZ2V0RnJlcXVlbmN5Q29sb3IiLCJtYXgiLCJtYXhJbmRleCIsImluZGV4T2YiLCJ1cGRhdGVTbG93QXZlcmFnZSIsInVuTXV0ZVRyYWNrIiwidHJhY2tOdW1iZXIiLCJtdXRlVHJhY2siLCJtdXRlQWxsIiwiaSIsIm5TcXVhcmVzIiwiaXNJbml0aWF0ZWQiLCJtb2JpbGVVc2FnZSIsImJhbGxIb21lIiwic2hvd0JhbGxzIiwic2hvdyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImJhbGwiLCJzdHlsZSIsImRpc3BsYXkiLCJnZXRTcXVhcmVJZCIsImlkIiwicGFydHMiLCJzcGxpdCIsInBhcnNlSW50Iiwic3Bpbm5lciIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJnZXRFbGVtZW50QnlJZCIsInJlbW92ZSIsImRyYXciLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJzcXVhcmUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJhZGRFdmVudExpc3RlbmVyIiwic3RhcnRCdXR0b24iLCJpbmZvIiwiYXN5bmMiLCJtYXRyaXgiLCJkcmFnZ2FibGUiLCJpbm5lclRleHQiLCJjcmVhdGVVSSIsImJhbGxzIiwic3F1YXJlcyIsImFjdGl2ZUJhbGwiLCJvcmlnaW5TcXVhcmUiLCJkcm9wQmFsbCIsInRhcmdldCIsImNvbnNvbGUiLCJsb2ciLCJlIiwicGFyZW50RWxlbWVudCIsImRhdGFUcmFuc2ZlciIsInNldERhdGEiLCJ0b3VjaGVzIiwicHJldmVudERlZmF1bHQiLCJ0b3VjaCIsImxlZnQiLCJjbGllbnRYIiwidG9wIiwiY2xpZW50WSIsImNoYW5nZWRUb3VjaGVzIiwidGFyZ2V0RWxlbWVudCIsImVsZW1lbnRGcm9tUG9pbnQiLCJpbml0VUkiLCJjcmVhdGVTdGFydEJ1dHRvbiJdLCJzb3VyY2VSb290IjoiIn0=